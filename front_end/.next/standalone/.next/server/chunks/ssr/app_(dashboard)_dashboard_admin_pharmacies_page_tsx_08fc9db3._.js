module.exports=[17605,a=>{"use strict";a.s(["default",()=>n]);var b=a.i(90944),c=a.i(72131),d=a.i(75320),e=a.i(5522),f=a.i(40695),g=a.i(64037),h=a.i(3130),i=a.i(97895);let j=[{key:"pending_kyc",title:"Pending KYC"},{key:"awaiting_payment",title:"Awaiting Payment"},{key:"pending_verification",title:"Awaiting Verification"},{key:"active",title:"Active Pharmacies"},{key:"blocked",title:"Blocked / Rejected"}],k={pending_kyc:"primary",awaiting_payment:"outline",pending_verification:"primary",active:"muted",blocked:"danger"};function l(a){return[...a].sort((a,b)=>{if(a.status_priority!==b.status_priority)return a.status_priority-b.status_priority;let c=a.created_at?new Date(a.created_at).getTime():0;return(b.created_at?new Date(b.created_at).getTime():0)-c})}function m(a,b={}){if(!a)return"-";try{return new Date(a).toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short",...b})}catch(b){return a}}function n(){let{show:a}=(0,g.useToast)(),[n,r]=(0,c.useState)(!0),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(0),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)({issueTempPassword:!1,tempPassword:""}),K=()=>{D(null),J({issueTempPassword:!1,tempPassword:""})};function L(a){D(a),J({issueTempPassword:!1,tempPassword:""})}async function M(b){try{await navigator.clipboard.writeText(b),a({variant:"success",title:"Copied",description:"Temporary password copied to clipboard"})}catch(b){a({variant:"destructive",title:"Copy failed",description:b?.message||"Unable to copy password"})}}async function N(b=1){r(!0);try{let a=await d.AdminAPI.pharmacies(b,20,y),c=l(a.items||[]);v(c),x(a.total||c.length),t(null)}catch(b){t(b.message||"Failed to load pharmacies"),a({variant:"destructive",title:"Error",description:b.message||"Failed to load"})}finally{r(!1)}}(0,c.useEffect)(()=>{N(1)},[]);let O=(0,c.useMemo)(()=>{let a=new Map;return j.forEach(b=>a.set(b.key,[])),u.forEach(b=>{let c=a.get(b.status_category)??a.get("blocked")??[];c.push(b),a.set(b.status_category,c)}),a},[u]);return(0,b.jsxs)(b.Fragment,{children:[G&&(0,b.jsx)("div",{className:"mb-6 rounded-xl border-2 border-emerald-200 bg-gradient-to-r from-emerald-50 to-green-50 p-4 shadow-sm",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),(0,b.jsx)("div",{className:"font-semibold text-emerald-800 text-base",children:"Temporary Credentials Issued"})]}),(0,b.jsxs)("div",{className:"text-sm text-emerald-700 ml-4",children:[G.name," ",(0,b.jsxs)("span",{className:"text-emerald-600",children:["(tenant ",G.tenantId,")"]})]}),(0,b.jsx)("div",{className:"text-xs text-emerald-600 ml-4",children:"Share the password securely with the owner"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 bg-white/70 rounded-lg p-3 border border-emerald-200",children:[(0,b.jsx)("span",{className:"font-mono text-emerald-900 font-semibold text-base tracking-wider",children:G.tempPassword}),(0,b.jsx)(f.Button,{size:"sm",variant:"outline",className:"border-emerald-300 text-emerald-700 hover:bg-emerald-100",onClick:()=>M(G.tempPassword),children:"Copy"})]})]})}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 pb-4 border-b border-gray-200",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Pharmacy Management"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Manage pharmacy applications and payments"})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(e.Input,{placeholder:"Search pharmacies...",value:y,onChange:a=>z(a.target.value),className:"pl-10 w-64 border-gray-300 focus:border-blue-500 focus:ring-blue-500"}),(0,b.jsx)("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),(0,b.jsx)(f.Button,{onClick:()=>N(1),className:"bg-blue-600 hover:bg-blue-700 text-white px-6",children:"Search"})]})]}),n?(0,b.jsx)("div",{className:"flex items-center justify-center py-16",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):s?(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-6 text-center",children:(0,b.jsx)("div",{className:"text-red-600 font-medium",children:s})}):0===u.length?(0,b.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-12 text-center",children:[(0,b.jsx)("div",{className:"text-gray-500 text-lg font-medium",children:"No pharmacies found"}),(0,b.jsx)("div",{className:"text-gray-400 text-sm mt-2",children:"Try adjusting your search criteria"})]}):(0,b.jsx)("div",{className:"space-y-8",children:j.map(c=>{let e=O.get(c.key)||[];return 0===e.length?null:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 rounded-lg p-4 border-l-4 border-blue-500",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:c.title}),(0,b.jsxs)("div",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold",children:[e.length," ",1===e.length?"pharmacy":"pharmacies"]})]}),(0,b.jsx)("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:e.map(c=>{let e=A===c.tenant_id,g=k[c.status_category]||"muted",j="pending_kyc"===c.status_category&&!!c.kyc_id,l="pending_kyc"===c.status_category&&!!c.kyc_id,n=c.pending_payment?.code||c.pending_payment_code,q="pending_verification"===c.status_category&&!!n,r="pending_verification"===c.status_category&&!!n,s=c.kyc;return(0,b.jsxs)(h.Card,{className:(0,i.cn)("transition-all duration-200 hover:shadow-xl cursor-pointer border-0 shadow-md bg-white",e&&"ring-2 ring-blue-500 shadow-xl transform scale-[1.02]"),onClick:()=>B(c.tenant_id),children:[(0,b.jsx)(h.CardHeader,{className:"pb-3",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.CardTitle,{className:"text-xl font-bold text-gray-900",children:c.name}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)("div",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded font-mono",children:c.tenant_id})})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,b.jsx)(p,{tone:g,children:c.status_label}),c.owner_approved&&(0,b.jsx)(p,{tone:"outline",children:"Owner approved"})]})]})}),(0,b.jsxs)(h.CardContent,{className:"space-y-5",children:[(0,b.jsxs)("div",{className:"grid gap-3",children:[(0,b.jsx)(o,{label:"Owner",value:c.owner_email||"-",description:c.owner_phone}),(0,b.jsx)(o,{label:"Created",value:m(c.created_at)}),(0,b.jsx)(o,{label:"Address",value:c.address||"-"}),(0,b.jsx)(o,{label:"Subscription",value:c.subscription?.status?c.subscription.status.replace("_"," ").toUpperCase():"-",description:c.subscription?.next_due_date?`Next due: ${m(c.subscription.next_due_date,{dateStyle:"medium"})}`:void 0}),n&&(0,b.jsxs)("div",{className:"rounded-lg border border-orange-200 p-4 space-y-3 bg-orange-50/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-2 h-2 bg-orange-500 rounded-full animate-pulse"}),(0,b.jsx)("div",{className:"text-sm font-bold text-orange-900",children:"Pending Payment"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-orange-700",children:"Code"}),(0,b.jsx)("span",{className:"font-mono bg-white px-2 py-1 rounded border text-orange-900 font-semibold",children:n})]}),c.pending_payment?.submitted_at&&(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-orange-700",children:"Submitted"}),(0,b.jsx)("span",{className:"text-sm text-orange-800",children:m(c.pending_payment.submitted_at)})]})]})]}),(0,b.jsx)(o,{label:"Latest payment",value:c.latest_payment?.code||c.latest_payment_code||"â€”",description:c.latest_payment?.status?`${c.latest_payment?.status?.toUpperCase?.()}${c.latest_payment?.submitted_at?` \xb7 ${m(c.latest_payment?.submitted_at)}`:""}`:void 0}),s&&(0,b.jsxs)("div",{className:"rounded-lg border border-blue-200 p-4 space-y-3 bg-blue-50/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),(0,b.jsx)("div",{className:"text-sm font-bold text-blue-900",children:"KYC Details"})]}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,b.jsx)(o,{label:"KYC Status",value:s.status?.toUpperCase()||"-"}),(0,b.jsx)(o,{label:"Submitted",value:m(s.submitted_at)}),(0,b.jsx)(o,{label:"ID Number",value:s.id_number||"-"}),(0,b.jsx)(o,{label:"License Number",value:s.pharmacy_license_number||"-"}),s.pharmacy_name&&(0,b.jsx)(o,{label:"Registered Pharmacy Name",value:s.pharmacy_name}),s.pharmacy_address&&(0,b.jsx)(o,{label:"Registered Address",value:s.pharmacy_address}),s.owner_email&&(0,b.jsx)(o,{label:"Owner Email (submitted)",value:s.owner_email}),s.owner_phone&&(0,b.jsx)(o,{label:"Owner Phone (submitted)",value:s.owner_phone})]}),s.notes&&(0,b.jsxs)("div",{className:"text-xs text-blue-700 bg-blue-100 p-2 rounded",children:["Notes: ",s.notes]}),s.license_document_available&&s.application_id&&(0,b.jsx)(f.Button,{variant:"outline",size:"sm",className:"border-blue-300 text-blue-700 hover:bg-blue-100",onClick:b=>{b.stopPropagation();let c=s.application_id;"number"==typeof c&&d.AdminAPI.downloadPharmacyLicense(c).catch(b=>a({variant:"destructive",title:"Download failed",description:b.message||"Unable to download license"}))},children:"Download License"})]}),c.owner_password_hash&&(0,b.jsx)(o,{label:"Owner Password Hash",value:c.owner_password_hash,masked:!0})]}),(0,b.jsx)("div",{className:"border-t border-gray-200 pt-4 mt-4",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,b.jsx)(f.Button,{disabled:!j,className:"bg-green-600 hover:bg-green-700 text-white disabled:bg-gray-300 disabled:text-gray-500",onClick:a=>{a.stopPropagation(),L({type:"approve",tenantId:c.tenant_id,kycId:c.kyc_id,name:c.name})},children:"âœ“ Approve"}),(0,b.jsx)(f.Button,{variant:"outline",disabled:!l,className:"border-red-300 text-red-700 hover:bg-red-50 disabled:border-gray-300 disabled:text-gray-500",onClick:a=>{a.stopPropagation(),L({type:"reject",tenantId:c.tenant_id,kycId:c.kyc_id,name:c.name})},children:"âœ— Reject"}),(0,b.jsx)(f.Button,{disabled:!q,className:"bg-blue-600 hover:bg-blue-700 text-white disabled:bg-gray-300 disabled:text-gray-500",onClick:a=>{a.stopPropagation(),L({type:"verify",tenantId:c.tenant_id,name:c.name,pendingPayment:c.pending_payment})},children:"ðŸ’³ Verify Payment"}),(0,b.jsx)(f.Button,{variant:"outline",disabled:!r,className:"border-orange-300 text-orange-700 hover:bg-orange-50 disabled:border-gray-300 disabled:text-gray-500",onClick:a=>{a.stopPropagation(),L({type:"rejectPayment",tenantId:c.tenant_id,name:c.name,pendingPayment:c.pending_payment})},children:"âš  Reject Payment"})]})})]})]},c.id)})})]},c.key)})})]}),C&&(0,b.jsx)(q,{action:C,loading:E,onCancel:()=>{E||K()},onConfirm:async()=>{if(!E){F(!0);try{switch(C.type){case"approve":{if(null==C.kycId){a({variant:"destructive",title:"Missing application",description:"No KYC record found for this tenant."}),F(!1);return}let b=I.tempPassword.trim();if(I.issueTempPassword&&b&&b.length<6){a({variant:"destructive",title:"Password too short",description:"Temporary passwords must be at least 6 characters."}),F(!1);return}let c=await d.AdminAPI.approvePharmacy(C.tenantId,C.kycId,{issue_temp_password:I.issueTempPassword,temp_password:I.issueTempPassword&&b||void 0}),e=c?.temporary_password;e?H({tenantId:C.tenantId,name:C.name,tempPassword:e}):I.issueTempPassword&&b?H({tenantId:C.tenantId,name:C.name,tempPassword:b}):H(null),a({variant:"success",title:"Pharmacy approved",description:`${C.name} will be notified to pay`}),N();break}case"reject":await d.AdminAPI.rejectPharmacy(C.tenantId,C.kycId),a({variant:"success",title:"Pharmacy rejected",description:C.name}),N();break;case"verify":{var b;let c=await d.AdminAPI.verifyPayment(C.tenantId,C.pendingPayment?.code||void 0);a({variant:"success",title:"Payment verified",description:`${C.name} notified`}),b=C.tenantId,v(a=>l(a.map(a=>a.tenant_id===b?(a=>({...a,status_category:"active",status_label:"Active",status_priority:40,subscription:{...a.subscription||{},blocked:!1,status:"active",next_due_date:c?.next_due_date||a.subscription?.next_due_date||null},pending_payment:null,pending_payment_code:null,pending_payment_submitted_at:null,latest_payment:{code:C.pendingPayment?.code||c?.payment_code||a.latest_payment?.code||a.latest_payment_code,status:"verified",submitted_at:C.pendingPayment?.submitted_at||a.latest_payment?.submitted_at||a.latest_payment_submitted_at,verified_at:new Date().toISOString()},latest_payment_code:C.pendingPayment?.code||c?.payment_code||a.latest_payment_code,latest_payment_status:"verified",latest_payment_submitted_at:C.pendingPayment?.submitted_at||a.latest_payment_submitted_at,latest_payment_verified_at:new Date().toISOString()}))(a):a)));break}case"rejectPayment":await d.AdminAPI.rejectPayment(C.tenantId,C.pendingPayment?.code||void 0),a({variant:"success",title:"Payment rejected",description:`${C.name} informed to retry`}),N()}K()}catch(b){a({variant:"destructive",title:"Action failed",description:b?.message||"Something went wrong"})}finally{F(!1)}}},options:I,setOptions:a=>J(a)})]})}function o({label:a,value:d,description:e,className:f,masked:g}){let[h,j]=(0,c.useState)(!g);return(0,b.jsxs)("div",{className:(0,i.cn)("space-y-2 rounded-lg border border-gray-200 p-3 bg-gray-50/50 hover:bg-gray-50 transition-colors",f),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wide text-gray-600",children:a}),g&&(0,b.jsx)("button",{type:"button",className:"text-xs text-blue-600 hover:text-blue-800 font-medium",onClick:()=>j(a=>!a),children:h?"Hide":"Show"})]}),(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900 break-all",children:g&&!h?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢":d}),e&&(0,b.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:e})]})}function p({children:a,tone:c="primary"}){return(0,b.jsx)("span",{className:(0,i.cn)("rounded-full px-3 py-1 text-xs font-semibold shadow-sm","primary"===c?"bg-blue-100 text-blue-800 border border-blue-200":"danger"===c?"bg-red-100 text-red-800 border border-red-200":"outline"===c?"border border-gray-300 text-gray-700 bg-white":"bg-gray-100 text-gray-700 border border-gray-200"),children:a})}function q({action:a,onConfirm:c,onCancel:d,loading:e,options:g,setOptions:h}){let i={approve:{title:"Approve pharmacy",description:`Are you sure you want to approve ${a.name} and notify them to pay?`,confirm:"Yes, approve"},reject:{title:"Reject pharmacy",description:`Reject ${a.name}'s application? They will be notified immediately.`,confirm:"Yes, reject"},verify:{title:"Verify payment",description:`Confirm that ${a.name} has paid and unblock their subscription?`,confirm:"Yes, verify"},rejectPayment:{title:"Reject payment",description:`Reject ${a.name}'s submitted payment and ask them to retry?`,confirm:"Yes, reject payment"}}[a.type],j=a.pendingPayment;return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4 backdrop-blur-sm",children:(0,b.jsxs)("div",{className:"w-full max-w-md rounded-xl bg-white p-6 shadow-2xl border border-gray-200",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:i.title}),(0,b.jsx)("p",{className:"mt-3 text-sm text-gray-600",children:i.description}),j&&("verify"===a.type||"rejectPayment"===a.type)&&(0,b.jsxs)("div",{className:"mt-4 rounded-lg border border-blue-200 bg-blue-50 p-4",children:[(0,b.jsx)("div",{className:"font-semibold text-sm mb-3 text-blue-900",children:"Payment Details"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Code:"}),(0,b.jsx)("span",{className:"font-mono bg-white px-2 py-1 rounded border text-blue-900",children:j.code})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Submitted:"}),(0,b.jsx)("span",{className:"text-gray-900",children:m(j.submitted_at)})]})]})]}),"approve"===a.type&&(0,b.jsxs)("div",{className:"mt-4 space-y-4 border border-green-200 rounded-lg bg-green-50 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-green-900",children:"Issue temporary password"}),(0,b.jsx)("input",{type:"checkbox",checked:!!g.issueTempPassword,onChange:a=>h({...g,issueTempPassword:a.target.checked}),className:"w-4 h-4 text-green-600 rounded focus:ring-green-500"})]}),g.issueTempPassword&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-green-700",htmlFor:"temp-password-input",children:"Password"}),(0,b.jsx)("input",{id:"temp-password-input",type:"text",value:g.tempPassword??"",onChange:a=>h({...g,tempPassword:a.target.value}),className:"w-full rounded-lg border border-green-300 px-3 py-2 text-sm focus:border-green-500 focus:ring-green-500",placeholder:"Auto-generate if left blank"}),(0,b.jsx)("button",{type:"button",className:"text-xs text-green-600 hover:text-green-800 font-medium",onClick:()=>h({...g,tempPassword:function(a=12){let b="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789",c="";for(let d=0;d<a;d++)c+=b.charAt(Math.floor(Math.random()*b.length));return c}()}),children:"Generate strong password"})]})]}),(0,b.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:d,disabled:e,children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:c,disabled:e,children:e?"Processing...":i.confirm})]})]})})}}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_admin_pharmacies_page_tsx_08fc9db3._.js.map