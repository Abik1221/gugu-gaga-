module.exports=[3130,a=>{"use strict";a.s(["Card",()=>e,"CardContent",()=>h,"CardFooter",()=>i,"CardHeader",()=>f,"CardTitle",()=>g]);var b=a.i(90944),c=a.i(72131),d=a.i(97895);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("rounded-2xl border border-white/20 bg-white/70 p-6 shadow-[0_20px_70px_-40px_rgba(16,185,129,0.65)] backdrop-blur-md",a),...c}));e.displayName="Card";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("mb-3 flex items-center justify-between gap-4",a),...c}));f.displayName="CardHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("h4",{ref:e,className:(0,d.cn)("text-lg font-semibold leading-tight text-emerald-900",a),...c}));g.displayName="CardTitle";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("text-sm leading-relaxed text-slate-700",a),...c}));h.displayName="CardContent";let i=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("mt-4 flex flex-wrap items-center justify-between gap-3",a),...c}));i.displayName="CardFooter"},5522,a=>{"use strict";a.s(["Input",()=>c]);var b=a.i(90944);let c=a.i(72131).forwardRef(({className:a="",...c},d)=>(0,b.jsx)("input",{ref:d,className:"w-full border rounded px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-200 focus:border-emerald-400 "+a,...c}));c.displayName="Input"},50463,a=>{"use strict";a.s(["Skeleton",()=>c,"TableSkeletonRows",()=>d]);var b=a.i(90944);function c({className:a=""}){return(0,b.jsx)("div",{className:`animate-pulse bg-gray-200 rounded ${a}`})}function d({rows:a=6,cols:d=6}){return(0,b.jsx)("tbody",{children:Array.from({length:a}).map((a,e)=>(0,b.jsx)("tr",{className:"border-t",children:Array.from({length:d}).map((a,d)=>(0,b.jsx)("td",{className:"px-3 py-2",children:(0,b.jsx)(c,{className:"h-4 w-full"})},d))},e))})}},37977,a=>{"use strict";a.s(["default",()=>l]);var b=a.i(90944),c=a.i(72131),d=a.i(75320),e=a.i(3130),f=a.i(40695),g=a.i(5522),h=a.i(50463),i=a.i(64037);let j=new Intl.NumberFormat("en-US",{style:"currency",currency:"ETB",minimumFractionDigits:0,maximumFractionDigits:2});function k(a){return j.format(Number.isFinite(a)?a:0)}function l(){let{show:a}=(0,i.useToast)(),[j,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let b=!0;return async function(){try{let a=await d.AuthAPI.me();if(!b)return;l(a),n(a?.tenant_id||null)}catch(c){if(!b)return;a({variant:"destructive",title:"Unable to load POS",description:c?.message||"Please try again."})}finally{b&&p(!1)}}(),()=>{b=!1}},[a]);let K=(0,c.useCallback)(async a=>{r(!0),z(null);try{let{items:b}=await d.InventoryAPI.list(a,{q:w||void 0,branch:u||void 0,lowStockOnly:!1,pageSize:100});t(b)}catch(a){t([]),z(a?.message||"Unable to load inventory")}finally{r(!1)}},[w,u]),L=(0,c.useCallback)(async b=>{D(!0);try{let{items:a}=await d.MedicinesAPI.list(b,{pageSize:200});B(a)}catch(b){a({variant:"destructive",title:"Unable to load medicines",description:b?.message||"Try again."})}finally{D(!1)}},[a]);(0,c.useEffect)(()=>{m&&L(m)},[m,L]),(0,c.useEffect)(()=>{m&&K(m)},[m,K]);let M=(0,c.useMemo)(()=>{let a=new Set;return s.forEach(b=>{b.branch&&a.add(b.branch)}),Array.from(a).sort()},[s]),N=(0,c.useMemo)(()=>G.reduce((a,b)=>a+b.quantity*b.unitPrice,0),[G]),O=(a,b)=>{H(c=>c.map(c=>c.key===a?b(c):c))},P=()=>{H([]),F("")},Q=async()=>{if(!m)return;if(0===G.length)return void a({variant:"destructive",title:"Cart empty",description:"Add at least one item."});let b=G.map(a=>({name_or_sku:a.medicine.sku||a.medicine.name,quantity_units:a.quantity,unit_price:a.unitPrice}));J(!0);try{let c=await d.SalesAPI.pos(m,{lines:b,branch:E||void 0});a({variant:"success",title:"Sale completed",description:`Receipt #${c.id} • Total ${k(c.total)}`}),P(),m&&K(m)}catch(b){a({variant:"destructive",title:"Sale failed",description:b?.message||"Please try again."})}finally{J(!1)}};return(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("header",{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Sales console"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Look up medicine lots, build the cart, and issue receipts that sync with owner analytics."})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600",children:[(0,b.jsx)("span",{children:"Cashier:"}),(0,b.jsx)("span",{className:"font-medium text-gray-900",children:j?.username||"—"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"•"}),(0,b.jsx)("span",{children:"Tenant:"})]})]}),(0,b.jsxs)("section",{className:"grid gap-6 xl:grid-cols-5",children:[(0,b.jsxs)(e.Card,{className:"xl:col-span-3",children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-col gap-3",children:[(0,b.jsx)(e.CardTitle,{children:"Lot lookup"}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,b.jsx)(g.Input,{value:w,onChange:a=>x(a.target.value),placeholder:"Search medicine name or SKU"}),(0,b.jsxs)("select",{value:u,onChange:a=>v(a.target.value),className:"rounded border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm focus:outline-none focus:ring",children:[(0,b.jsx)("option",{value:"",children:"All branches"}),M.map(a=>(0,b.jsx)("option",{value:a,children:a},a))]}),(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>{m&&K(m)},disabled:q,children:"Refresh lots"})]})]}),(0,b.jsxs)(e.CardContent,{className:"space-y-3",children:[y&&(0,b.jsx)("div",{className:"rounded border border-red-200 bg-red-50 p-2 text-xs text-red-700",children:y}),q?(0,b.jsx)(h.Skeleton,{className:"h-40 w-full"}):(0,b.jsxs)("div",{className:"max-h-[420px] space-y-2 overflow-auto rounded border border-gray-200 bg-white",children:[s.map(c=>(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3 border-b px-3 py-2 last:border-b-0",children:[(0,b.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,b.jsx)("div",{className:"font-medium text-gray-900",children:c.medicine_name}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["SKU: ",c.sku||"—"," • Branch: ",c.branch||"—"]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["Qty: ",c.quantity," • Reorder: ",c.reorder_level," • Exp: ",c.expiry_date||"—"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900",children:k(c.sell_price??0)}),(0,b.jsx)(f.Button,{size:"sm",onClick:()=>(b=>{let c=A.find(a=>a.id===b.medicine_id),d=b.sell_price??0;if(!c)return void a({variant:"destructive",title:"Medicine not found",description:"Unable to match medicine for this lot."});H(a=>{let e=a.find(a=>a.lot?.id===b.id);return e?a.map(a=>a.key===e.key?{...a,quantity:Math.min(a.quantity+1,b.quantity||0),unitPrice:d||a.unitPrice}:a):[...a,{key:`${b.id}-${Date.now()}`,medicine:{...c,price:d},lot:b,quantity:1,unitPrice:d||0}]})})(c),children:"Add"})]})]},c.id)),0===s.length&&(0,b.jsx)("div",{className:"p-4 text-sm text-gray-500",children:"No lots match your filters."})]})]})]}),(0,b.jsxs)(e.Card,{className:"xl:col-span-2",children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-col gap-2",children:[(0,b.jsx)(e.CardTitle,{children:"Quick-add medicine"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Use this when the lot is not tracked yet. You’ll enter the sale price manually."})]}),(0,b.jsx)(e.CardContent,{className:"space-y-3",children:C?(0,b.jsx)(h.Skeleton,{className:"h-10 w-full"}):(0,b.jsxs)("select",{value:"",onChange:a=>{let b=Number(a.target.value),c=A.find(a=>a.id===b);c&&H(a=>[...a,{key:`${c.id}-${Date.now()}`,medicine:c,lot:null,quantity:1,unitPrice:0}])},className:"w-full rounded border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm focus:outline-none focus:ring",children:[(0,b.jsx)("option",{value:"",children:"Select medicine..."}),A.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," ",a.sku?`(${a.sku})`:""]},a.id))]})})]})]}),(0,b.jsx)("section",{children:(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[(0,b.jsx)(e.CardTitle,{children:"Sale builder"}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(g.Input,{value:E,onChange:a=>F(a.target.value),placeholder:"Branch / till (optional)",className:"w-60"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:P,children:"Clear sale"})]})]}),(0,b.jsx)(e.CardContent,{className:"space-y-4",children:0===G.length?(0,b.jsx)("div",{className:"rounded border border-dashed border-gray-200 p-6 text-center text-sm text-gray-500",children:"Add items from the left or quick-add a medicine to begin building the cart."}):(0,b.jsx)("div",{className:"space-y-3",children:G.map(a=>(0,b.jsx)("div",{className:"rounded border border-gray-200 bg-white p-3",children:(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:a.medicine.name}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:[a.medicine.sku?`SKU ${a.medicine.sku}`:"Manual entry",a.lot?` • Lot ${a.lot.lot_number||a.lot.id}`:null]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[(0,b.jsx)("label",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Qty"}),(0,b.jsx)(g.Input,{type:"number",min:1,value:a.quantity,onChange:b=>{let c=Math.max(1,Number(b.target.value)||1);O(a.key,a=>({...a,quantity:c}))},className:"w-24"}),a.lot&&(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:["Stock: ",a.lot.quantity," units"]}),(0,b.jsx)("label",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Price"}),(0,b.jsx)(g.Input,{type:"number",min:0,step:"0.01",value:a.unitPrice,onChange:b=>{let c=Math.max(0,Number(b.target.value)||0);O(a.key,a=>({...a,unitPrice:c}))},className:"w-28"}),(0,b.jsx)("div",{className:"font-semibold text-gray-900",children:k(a.quantity*a.unitPrice)}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>{var b;return b=a.key,void H(a=>a.filter(a=>a.key!==b))},children:"Remove"})]})]})},a.key))})}),(0,b.jsxs)(e.CardFooter,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:["Cart lines: ",G.length," • Total quantity: ",G.reduce((a,b)=>a+b.quantity,0)]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 text-right",children:[(0,b.jsxs)("div",{className:"text-lg font-semibold text-gray-900",children:["Total due: ",k(N)]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:P,children:"Reset"}),(0,b.jsx)(f.Button,{onClick:Q,disabled:I||0===G.length,children:I?"Processing...":"Complete sale"})]})]})]})]})})]})}}];

//# sourceMappingURL=_e7b36187._.js.map