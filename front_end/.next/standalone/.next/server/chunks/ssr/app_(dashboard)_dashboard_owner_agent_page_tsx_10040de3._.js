module.exports=[27483,a=>{"use strict";a.s(["default",()=>l]);var b=a.i(90944),c=a.i(72131),d=a.i(75320),e=a.i(40695),f=a.i(50463),g=a.i(64037);let h={user:"You",owner:"You",assistant:"Assistant"},i={user:"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/20",owner:"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/20",assistant:"bg-white/90 border border-white/40 text-slate-900 backdrop-blur"};function j(a,b){let c=(a.title||"").trim();return c||`Conversation #${b+1}`}function k({payload:a}){if(!a||"object"!=typeof a)return null;let c=Array.isArray(a.rows)?a.rows:null,d=c&&c.length>0;return MAX_PROMPT_LENGTH,messageDraft.length,(0,b.jsxs)("div",{className:"space-y-4 text-sm",children:[a.intent&&(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border border-emerald-200 bg-emerald-50 px-4 py-3 text-emerald-800",children:[(0,b.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wider",children:"Intent"}),(0,b.jsx)("span",{className:"font-medium",children:String(a.intent)})]}),a.error&&(0,b.jsxs)("div",{className:"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800",children:["Unable to run the analysis at the moment. (",String(a.error),")"]}),a.answer&&"string"==typeof a.answer&&(0,b.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed text-slate-800",children:a.answer}),d?(0,b.jsx)("div",{className:"overflow-x-auto rounded-lg border border-slate-200",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-slate-200 text-sm",children:[(0,b.jsx)("thead",{className:"bg-slate-50",children:(0,b.jsx)("tr",{children:Object.keys(c[0]).map(a=>(0,b.jsx)("th",{className:"px-4 py-3 text-left font-semibold uppercase tracking-wider text-slate-900",children:a},a))})}),(0,b.jsx)("tbody",{className:"divide-y divide-slate-100 bg-white",children:c.map((a,d)=>(0,b.jsx)("tr",{className:"hover:bg-slate-50",children:Object.keys(c[0]).map(c=>(0,b.jsx)("td",{className:"px-4 py-3 text-slate-700",children:null===a[c]||void 0===a[c]?"—":"number"==typeof a[c]?a[c].toLocaleString("en-US"):String(a[c])},c))},d))})]})}):null,!a.error&&c&&0===c.length&&(0,b.jsx)("div",{className:"rounded-lg border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-600",children:"The query completed but returned no rows."})]})}function l(){let{show:a}=(0,g.useToast)(),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!0),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(!1),L=(0,c.useRef)(null),M=(0,c.useMemo)(()=>n.find(a=>a.id===r)||null,[n,r]),N=(0,c.useCallback)(async a=>{q(!0);try{let b=await d.ChatAPI.listThreads(a),c=Array.isArray(b)?b:[];return o(c),0===c.length&&s(null),I(null),c}catch(a){return o([]),s(null),I(a?.message||"Unable to load conversations"),[]}finally{q(!1)}},[]),O=(0,c.useCallback)(async(b,c)=>{w(!0);try{let a=await d.ChatAPI.listMessages(b,c),e=Array.isArray(a)?a:[];u(e)}catch(b){a({variant:"destructive",title:"Failed to load thread",description:b?.message||"Unable to fetch messages."})}finally{w(!1)}},[a]);(0,c.useEffect)(()=>{let a=!0;return async function(){G(!0);try{let b=await d.AuthAPI.me();if(!a)return;let c=b?.tenant_id||null;if(!c)return void I("You do not have an active tenant to chat against.");m(c),await N(c)}catch(b){if(!a)return;I(b?.message||"Unable to load owner profile.")}finally{a&&G(!1)}}(),()=>{a=!1}},[N]),(0,c.useEffect)(()=>{r&&!n.some(a=>a.id===r)?s(n[0]?.id??null):!r&&n.length>0&&s(n[0].id)},[n,r]),(0,c.useEffect)(()=>{if(!l||!r)return void u([]);O(l,r)},[l,r,O]),(0,c.useEffect)(()=>{L.current&&L.current.scrollIntoView({behavior:"smooth"})},[t,D]);let P=async()=>{if(l){A(!0);try{let a=await d.ChatAPI.createThread(l);await N(l),a?.id&&s(a.id),u([])}catch(b){a({variant:"destructive",title:"Could not create thread",description:b?.message||"Please try again."})}finally{A(!1)}}},Q=300-x.length,R=Q<0,S=async()=>{if(!l)return;let b=x.trim();if(b){if(b.length>300)return void a({variant:"destructive",title:"Prompt too long",description:"Limit is 300 characters. Please shorten your question."});y(""),C(!0),E(!0);try{let a=r;if(!a){let b=await d.ChatAPI.createThread(l),c=await N(l);(a=(b&&"number"==typeof b.id?b.id:void 0)??(c.length>0?c[0].id:void 0))&&s(a)}if(!a)throw Error("Unable to start a new conversation");await d.ChatAPI.sendMessage(l,a,b),await O(l,a),await N(l)}catch(c){a({variant:"destructive",title:"Message failed",description:c?.message||"Unable to send message."}),y(b)}finally{C(!1),E(!1)}}},T=p||F,U=v||F;return(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 rounded-2xl border border-slate-200 bg-white p-6 shadow-md",children:[(0,b.jsx)("h1",{className:"text-3xl font-semibold leading-tight text-slate-900",children:"Zemen AI Assistant"}),(0,b.jsx)("p",{className:"max-w-3xl text-sm leading-relaxed text-slate-600",children:"Ask questions about sales, inventory, and staff performance. The assistant runs read-only analytics on your tenant data and summarises the results for quick insight."})]}),H&&(0,b.jsx)("div",{className:"rounded border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:H}),(0,b.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[320px,1fr]",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-5 rounded-2xl border border-slate-200 bg-white p-5 shadow-md",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-sm font-semibold uppercase tracking-wider text-slate-900",children:"Conversations"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Button,{size:"sm",variant:"outline",onClick:()=>K(a=>!a),children:J?"Hide history":"Show history"}),(0,b.jsx)(e.Button,{size:"sm",variant:"outline",onClick:()=>l&&N(l),disabled:!l||T,children:"Refresh"})]})]}),(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsx)(e.Button,{onClick:P,disabled:!l||z,className:"bg-emerald-700 hover:bg-emerald-800 text-white",children:z?"Creating…":"Start new conversation"})}),J?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"h-px w-full bg-slate-200"}),T?(0,b.jsx)("div",{className:"space-y-2",children:Array.from({length:5}).map((a,c)=>(0,b.jsx)(f.Skeleton,{className:"h-12 w-full"},c))}):0===n.length?(0,b.jsx)("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4 text-center text-sm text-slate-600",children:"No conversations yet. Start a new one to ask the assistant anything about your pharmacy."}):(0,b.jsx)("div",{className:"space-y-2",children:n.map((a,c)=>{let d=j(a,c),e=a.id===r;return(0,b.jsxs)("button",{type:"button",onClick:()=>s(a.id),className:`group w-full rounded-lg border px-3 py-2 text-left text-sm font-medium transition ${e?"border-emerald-300 bg-emerald-50 text-emerald-900 shadow-sm":"border-slate-200 bg-white text-slate-700 hover:border-emerald-200 hover:bg-emerald-50"}`,children:[(0,b.jsx)("div",{className:"font-semibold",children:d}),(0,b.jsxs)("div",{className:"text-xs uppercase tracking-wider text-slate-500",children:["Thread #",a.id]})]},a.id)})})]}):(0,b.jsx)("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4 text-center text-sm text-slate-600",children:"Tap “Show history” to browse your previous conversations."})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-5 rounded-2xl border border-slate-200 bg-white p-5 shadow-md",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-sm font-semibold uppercase tracking-wider text-slate-900",children:M?j(M,0):"Conversation"}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(e.Button,{size:"sm",variant:"outline",onClick:()=>l&&r&&O(l,r),disabled:!l||!r||U,children:"Refresh"})})]}),(0,b.jsx)("p",{className:"text-xs text-slate-600",children:"The assistant uses safe, read-only queries. Ask for sales summaries, inventory gaps, or staff performance insights."})]}),(0,b.jsx)("div",{className:"flex-1 overflow-hidden rounded-lg border border-slate-200 bg-slate-50",children:U?(0,b.jsx)("div",{className:"p-4 space-y-3",children:Array.from({length:5}).map((a,c)=>(0,b.jsx)(f.Skeleton,{className:"h-16 w-full"},c))}):r?0===t.length?(0,b.jsx)("div",{className:"flex h-full items-center justify-center p-6 text-sm text-slate-600",children:"Ask your first question to begin."}):(0,b.jsxs)("div",{className:"flex h-[55vh] flex-col gap-3 overflow-y-auto p-4 pr-6",children:[t.map(a=>{let c=i[a.role]||i.assistant,d=h[a.role]||a.role,e="assistant"===a.role?function(a){if(!a)return null;try{return JSON.parse(a)}catch{if(a.startsWith("{")&&a.includes("'"))try{let b=a.replace(/'/g,'"');return JSON.parse(b)}catch{}return null}}(a.content):null;return(0,b.jsx)("div",{className:`flex ${"assistant"===a.role?"justify-start":"justify-end"}`,children:(0,b.jsxs)("div",{className:`max-w-xl rounded-2xl px-3 py-2 text-sm shadow ${c}`,children:[(0,b.jsx)("div",{className:"mb-1 text-xs font-semibold uppercase tracking-wide text-slate-600",children:d}),e?(0,b.jsx)(k,{payload:e}):(0,b.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed",children:a.content})]})},a.id)}),D&&(0,b.jsx)("div",{className:"flex justify-start",children:(0,b.jsx)("div",{className:"max-w-xs rounded-lg border border-slate-200 bg-slate-100 px-3 py-2 text-sm text-slate-700 shadow-sm",children:"Assistant is analysing your data…"})}),(0,b.jsx)("div",{ref:L})]}):(0,b.jsx)("div",{className:"flex h-full items-center justify-center p-6 text-sm text-slate-600",children:"Select a conversation to view messages."})}),(0,b.jsxs)("form",{className:"flex flex-col gap-3 rounded-lg border border-slate-200 bg-white p-4 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs font-semibold uppercase tracking-wider text-slate-700",children:[(0,b.jsx)("span",{children:"Ask a question"}),(0,b.jsx)("span",{className:`tracking-normal ${R?"text-red-600":"text-emerald-600"}`,children:Q>=0?`${Q} characters left`:`${Math.abs(Q)} over limit`})]}),(0,b.jsx)("textarea",{className:"min-h-[120px] w-full resize-y rounded-lg border border-slate-300 bg-white p-3 text-sm text-slate-900 placeholder:text-slate-500 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200",placeholder:"e.g. Show me the top selling medicines this week",value:x,maxLength:400,onChange:a=>y(a.target.value),onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),S())}}),(0,b.jsx)(e.Button,{onClick:S,disabled:!l||!r||B||R,className:"bg-emerald-700 hover:bg-emerald-800 text-white",children:B?"Sending…":"Send"})]}),")"]})]})]})}}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_owner_agent_page_tsx_10040de3._.js.map