{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/habtamusemagn/Desktop/last/gugu-gaga-/front_end/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS;IAAG,IAAA,IAAA,OAAA,UAAA,QAAA,AAAG,SAAH,UAAA,OAAA,OAAA,GAAA,OAAA,MAAA;QAAG,OAAH,QAAA,SAAA,CAAA,KAAuB;;IACxC,OAAO,IAAA,uOAAO,EAAC,IAAA,iMAAI,EAAC;AACtB","debugId":null}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["file:///home/habtamusemagn/Desktop/last/gugu-gaga-/front_end/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-semibold transition-all duration-200 disabled:pointer-events-none disabled:opacity-60 shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300/70 focus-visible:ring-offset-2 focus-visible:ring-offset-transparent aria-invalid:border-destructive aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 cursor-pointer\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-gradient-to-r from-emerald-500 via-emerald-600 to-teal-500 text-white shadow-lg shadow-emerald-500/25 hover:from-emerald-500/90 hover:via-emerald-600/90 hover:to-teal-500/90 hover:shadow-emerald-500/40\",\n        destructive:\n          \"bg-gradient-to-r from-red-500 to-rose-500 text-white shadow-lg shadow-red-500/30 hover:from-red-500/90 hover:to-rose-500/90 focus-visible:ring-red-400/40\",\n        outline:\n          \"border border-emerald-300/60 bg-white/80 text-emerald-700 backdrop-blur-sm shadow-sm hover:border-emerald-400 hover:bg-white\",\n        secondary:\n          \"bg-emerald-50 text-emerald-700 shadow-sm hover:bg-emerald-100\",\n        ghost:\n          \"text-emerald-500 hover:bg-emerald-50 hover:text-emerald-700\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2 has-[>svg]:px-3\",\n        sm: \"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\n        lg: \"h-10 rounded-md px-6 has-[>svg]:px-4\",\n        icon: \"size-9\",\n        \"icon-sm\": \"size-8\",\n        \"icon-lg\": \"size-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean\n  }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,qPAAG,EACxB,giBACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,KASb;QATa,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OAIF,GATa;IAUd,MAAM,OAAO,UAAU,+SAAI,GAAG;IAE9B,qBACE,mWAAC;QACC,aAAU;QACV,WAAW,IAAA,qHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf;KAnBS","debugId":null}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///home/habtamusemagn/Desktop/last/gugu-gaga-/front_end/components/ui/skeleton.tsx"],"sourcesContent":["\"use client\";\nimport React from \"react\";\n\nexport function Skeleton({ className = \"\" }: { className?: string }) {\n  return <div className={`animate-pulse bg-gray-200 rounded ${className}`} />;\n}\n\nexport function TableSkeletonRows({ rows = 6, cols = 6 }: { rows?: number; cols?: number }) {\n  return (\n    <tbody>\n      {Array.from({ length: rows }).map((_, r) => (\n        <tr key={r} className=\"border-t\">\n          {Array.from({ length: cols }).map((__, c) => (\n            <td key={c} className=\"px-3 py-2\">\n              <Skeleton className=\"h-4 w-full\" />\n            </td>\n          ))}\n        </tr>\n      ))}\n    </tbody>\n  );\n}\n"],"names":[],"mappings":";;;;;;;AAAA;;AAGO,SAAS,SAAS,KAA0C;QAA1C,EAAE,YAAY,EAAE,EAA0B,GAA1C;IACvB,qBAAO,mWAAC;QAAI,WAAW,AAAC,qCAA8C,OAAV;;;;;;AAC9D;KAFgB;AAIT,SAAS,kBAAkB,KAAwD;QAAxD,EAAE,OAAO,CAAC,EAAE,OAAO,CAAC,EAAoC,GAAxD;IAChC,qBACE,mWAAC;kBACE,MAAM,IAAI,CAAC;YAAE,QAAQ;QAAK,GAAG,GAAG,CAAC,CAAC,GAAG,kBACpC,mWAAC;gBAAW,WAAU;0BACnB,MAAM,IAAI,CAAC;oBAAE,QAAQ;gBAAK,GAAG,GAAG,CAAC,CAAC,IAAI,kBACrC,mWAAC;wBAAW,WAAU;kCACpB,cAAA,mWAAC;4BAAS,WAAU;;;;;;uBADb;;;;;eAFJ;;;;;;;;;;AAUjB;MAdgB","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///home/habtamusemagn/Desktop/last/gugu-gaga-/front_end/app/%28dashboard%29/dashboard/owner/agent/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { AuthAPI, ChatAPI } from \"@/utils/api\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/components/ui/toast\";\n\ntype ThreadSummary = {\n  id: number;\n  title?: string | null;\n};\n\ntype ChatMessageRecord = {\n  id: number;\n  role: string;\n  content: string;\n};\n\nconst ROLE_LABELS: Record<string, string> = {\n  user: \"You\",\n  owner: \"You\",\n  assistant: \"Assistant\",\n};\n\nconst ROLE_TONE: Record<string, string> = {\n  user: \"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/20\",\n  owner: \"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/20\",\n  assistant: \"bg-white/90 border border-white/40 text-slate-900 backdrop-blur\",\n};\n\nfunction normalizeThreadTitle(thread: ThreadSummary, index: number): string {\n  const raw = (thread.title || \"\").trim();\n  if (raw) return raw;\n  return `Conversation #${index + 1}`;\n}\n\nfunction parseAssistantPayload(content: string): any | null {\n  if (!content) return null;\n  try {\n    return JSON.parse(content);\n  } catch {\n    if (content.startsWith(\"{\") && content.includes(\"'\")) {\n      try {\n        const sanitized = content.replace(/'/g, '\"');\n        return JSON.parse(sanitized);\n      } catch {\n        return null;\n      }\n    }\n    return null;\n  }\n}\n\nfunction AssistantContent({ payload }: { payload: any }) {\n  if (!payload || typeof payload !== \"object\") {\n    return null;\n  }\n\n  const rows = Array.isArray(payload.rows) ? payload.rows : null;\n  const hasRows = rows && rows.length > 0;\n\n  const remaining = MAX_PROMPT_LENGTH - messageDraft.length;\n  const isOverLimit = remaining < 0;\n\n  return (\n    <div className=\"space-y-3 text-sm\">\n      {payload.intent && (\n        <div className=\"flex items-center gap-2 rounded border border-emerald-100 bg-emerald-50 px-3 py-2 text-emerald-700\">\n          <span className=\"text-xs font-semibold uppercase tracking-wide\">Intent</span>\n          <span className=\"font-medium\">{String(payload.intent)}</span>\n        </div>\n      )}\n      {payload.error && (\n        <div className=\"rounded border border-red-100 bg-red-50 px-3 py-2 text-sm text-red-700\">\n          Unable to run the analysis at the moment. ({String(payload.error)})\n        </div>\n      )}\n      {payload.answer && typeof payload.answer === \"string\" && (\n        <p className=\"whitespace-pre-wrap leading-relaxed text-gray-800\">{payload.answer}</p>\n      )}\n      {hasRows ? (\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-gray-200 text-xs\">\n            <thead className=\"bg-gray-50\">\n              <tr>\n                {Object.keys(rows![0]).map((key) => (\n                  <th\n                    key={key}\n                    className=\"px-3 py-2 text-left font-semibold uppercase tracking-wide text-gray-500\"\n                  >\n                    {key}\n                  </th>\n                ))}\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-100 bg-white\">\n              {rows!.map((row, idx) => (\n                <tr key={idx}>\n                  {Object.keys(rows![0]).map((key) => (\n                    <td key={key} className=\"px-3 py-2 text-gray-700\">\n                      {row[key] === null || row[key] === undefined\n                        ? \"—\"\n                        : typeof row[key] === \"number\"\n                        ? row[key].toLocaleString(\"en-US\")\n                        : String(row[key])}\n                    </td>\n                  ))}\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      ) : null}\n      {!payload.error && rows && rows.length === 0 && (\n        <div className=\"rounded border border-gray-200 bg-gray-50 px-3 py-2 text-xs text-gray-600\">\n          The query completed but returned no rows.\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default function OwnerAgentPage() {\n  const { show } = useToast();\n\n  const [tenantId, setTenantId] = useState<string | null>(null);\n  const [threads, setThreads] = useState<ThreadSummary[]>([]);\n  const [threadsLoading, setThreadsLoading] = useState(false);\n  const [selectedThreadId, setSelectedThreadId] = useState<number | null>(null);\n  const [messages, setMessages] = useState<ChatMessageRecord[]>([]);\n  const [messagesLoading, setMessagesLoading] = useState(false);\n  const [messageDraft, setMessageDraft] = useState(\"\");\n  const [creatingThread, setCreatingThread] = useState(false);\n  const [sending, setSending] = useState(false);\n  const [assistantThinking, setAssistantThinking] = useState(false);\n  const [bootstrapLoading, setBootstrapLoading] = useState(true);\n  const [globalError, setGlobalError] = useState<string | null>(null);\n  const [showHistory, setShowHistory] = useState(false);\n\n  const messagesEndRef = useRef<HTMLDivElement | null>(null);\n\n  const selectedThread = useMemo(\n    () => threads.find((thread) => thread.id === selectedThreadId) || null,\n    [threads, selectedThreadId],\n  );\n\n  const loadThreads = useCallback(\n    async (tid: string): Promise<ThreadSummary[]> => {\n      setThreadsLoading(true);\n      try {\n        const data = await ChatAPI.listThreads(tid);\n        const safe = Array.isArray(data) ? (data as ThreadSummary[]) : [];\n        setThreads(safe);\n        if (safe.length === 0) {\n          setSelectedThreadId(null);\n        }\n        setGlobalError(null);\n        return safe;\n      } catch (error: any) {\n        setThreads([]);\n        setSelectedThreadId(null);\n        setGlobalError(error?.message || \"Unable to load conversations\");\n        return [];\n      } finally {\n        setThreadsLoading(false);\n      }\n    },\n    [],\n  );\n\n  const loadMessages = useCallback(\n    async (tid: string, threadId: number) => {\n      setMessagesLoading(true);\n      try {\n        const data = await ChatAPI.listMessages(tid, threadId);\n        const safe = Array.isArray(data) ? (data as ChatMessageRecord[]) : [];\n        setMessages(safe);\n      } catch (error: any) {\n        show({\n          variant: \"destructive\",\n          title: \"Failed to load thread\",\n          description: error?.message || \"Unable to fetch messages.\",\n        });\n      } finally {\n        setMessagesLoading(false);\n      }\n    },\n    [show],\n  );\n\n  useEffect(() => {\n    let active = true;\n    async function bootstrap() {\n      setBootstrapLoading(true);\n      try {\n        const profile = await AuthAPI.me();\n        if (!active) return;\n        const tid = profile?.tenant_id || null;\n        if (!tid) {\n          setGlobalError(\"You do not have an active tenant to chat against.\");\n          return;\n        }\n        setTenantId(tid);\n        await loadThreads(tid);\n      } catch (error: any) {\n        if (!active) return;\n        setGlobalError(error?.message || \"Unable to load owner profile.\");\n      } finally {\n        if (active) setBootstrapLoading(false);\n      }\n    }\n    bootstrap();\n    return () => {\n      active = false;\n    };\n  }, [loadThreads]);\n\n  useEffect(() => {\n    if (selectedThreadId && !threads.some((thread) => thread.id === selectedThreadId)) {\n      setSelectedThreadId(threads[0]?.id ?? null);\n    } else if (!selectedThreadId && threads.length > 0) {\n      setSelectedThreadId(threads[0].id);\n    }\n  }, [threads, selectedThreadId]);\n\n  useEffect(() => {\n    if (!tenantId || !selectedThreadId) {\n      setMessages([]);\n      return;\n    }\n    loadMessages(tenantId, selectedThreadId);\n  }, [tenantId, selectedThreadId, loadMessages]);\n\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: \"smooth\" });\n    }\n  }, [messages, assistantThinking]);\n\n  const handleCreateThread = async () => {\n    if (!tenantId) return;\n    setCreatingThread(true);\n    try {\n      const created = await ChatAPI.createThread(tenantId);\n      await loadThreads(tenantId);\n      if (created?.id) {\n        setSelectedThreadId(created.id);\n      }\n      setMessages([]);\n    } catch (error: any) {\n      show({\n        variant: \"destructive\",\n        title: \"Could not create thread\",\n        description: error?.message || \"Please try again.\",\n      });\n    } finally {\n      setCreatingThread(false);\n    }\n  };\n\n  const MAX_PROMPT_LENGTH = 300;\n  const remaining = MAX_PROMPT_LENGTH - messageDraft.length;\n  const isOverLimit = remaining < 0;\n\n  const handleSendMessage = async () => {\n    if (!tenantId) return;\n    const prompt = messageDraft.trim();\n    if (!prompt) return;\n    if (prompt.length > MAX_PROMPT_LENGTH) {\n      show({\n        variant: \"destructive\",\n        title: \"Prompt too long\",\n        description: `Limit is ${MAX_PROMPT_LENGTH} characters. Please shorten your question.`,\n      });\n      return;\n    }\n    setMessageDraft(\"\");\n    setSending(true);\n    setAssistantThinking(true);\n    try {\n      let threadIdToUse = selectedThreadId;\n      if (!threadIdToUse) {\n        const created = await ChatAPI.createThread(tenantId);\n        const refreshed = await loadThreads(tenantId);\n        threadIdToUse =\n          (created && typeof created.id === \"number\" ? created.id : undefined) ??\n          (refreshed.length > 0 ? refreshed[0].id : undefined);\n        if (threadIdToUse) {\n          setSelectedThreadId(threadIdToUse);\n        }\n      }\n      if (!threadIdToUse) {\n        throw new Error(\"Unable to start a new conversation\");\n      }\n\n      await ChatAPI.sendMessage(tenantId, threadIdToUse, prompt);\n      await loadMessages(tenantId, threadIdToUse);\n      await loadThreads(tenantId);\n    } catch (error: any) {\n      show({\n        variant: \"destructive\",\n        title: \"Message failed\",\n        description: error?.message || \"Unable to send message.\",\n      });\n      setMessageDraft(prompt);\n    } finally {\n      setSending(false);\n      setAssistantThinking(false);\n    }\n  };\n\n  const handleComposerKeyDown = (event: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (event.key === \"Enter\" && !event.shiftKey) {\n      event.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const isLoadingThreads = threadsLoading || bootstrapLoading;\n  const isLoadingMessages = messagesLoading || bootstrapLoading;\n\n  return (\n    <div className=\"space-y-8\">\n      <div className=\"flex flex-col gap-3 rounded-3xl border border-white/15 bg-white/10 p-6 shadow-[0_28px_120px_-60px_rgba(16,185,129,0.75)] backdrop-blur-xl\">\n        <h1 className=\"text-3xl font-semibold leading-tight text-white\">Zemen AI Assistant</h1>\n        <p className=\"max-w-3xl text-sm leading-relaxed text-emerald-100/80\">\n          Ask questions about sales, inventory, and staff performance. The assistant runs read-only\n          analytics on your tenant data and summarises the results for quick insight.\n        </p>\n      </div>\n\n      {globalError && (\n        <div className=\"rounded border border-red-200 bg-red-50 p-3 text-sm text-red-700\">\n          {globalError}\n        </div>\n      )}\n\n      <div className=\"grid gap-6 lg:grid-cols-[320px,1fr]\">\n        <div className=\"flex flex-col gap-5 rounded-3xl border border-white/15 bg-white/10 p-5 shadow-[0_24px_90px_-50px_rgba(14,165,233,0.45)] backdrop-blur-xl\">\n          <div className=\"flex items-center justify-between text-emerald-100/80\">\n            <h2 className=\"text-sm font-semibold uppercase tracking-[0.3em] text-emerald-100\">Conversations</h2>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => setShowHistory((prev) => !prev)}\n              >\n                {showHistory ? \"Hide history\" : \"Show history\"}\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => tenantId && loadThreads(tenantId)}\n                disabled={!tenantId || isLoadingThreads}\n              >\n                Refresh\n              </Button>\n            </div>\n          </div>\n          <div className=\"space-y-3\">\n            <Button onClick={handleCreateThread} disabled={!tenantId || creatingThread}>\n              {creatingThread ? \"Creating…\" : \"Start new conversation\"}\n            </Button>\n          </div>\n          {showHistory ? (\n            <>\n              <div className=\"h-px w-full bg-gray-100\" />\n              {isLoadingThreads ? (\n                <div className=\"space-y-2\">\n                  {Array.from({ length: 5 }).map((_, index) => (\n                    <Skeleton key={index} className=\"h-12 w-full\" />\n                  ))}\n                </div>\n              ) : threads.length === 0 ? (\n                <div className=\"rounded-2xl border border-white/15 bg-white/5 p-4 text-center text-sm text-emerald-100/80\">\n                  No conversations yet. Start a new one to ask the assistant anything about your pharmacy.\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  {threads.map((thread, index) => {\n                    const title = normalizeThreadTitle(thread, index);\n                    const isActive = thread.id === selectedThreadId;\n                    return (\n                      <button\n                        key={thread.id}\n                        type=\"button\"\n                        onClick={() => setSelectedThreadId(thread.id)}\n                        className={`group w-full rounded-2xl border px-3 py-2 text-left text-sm font-medium transition ${\n                          isActive\n                            ? \"border-transparent bg-gradient-to-r from-emerald-500/25 via-teal-500/20 to-sky-500/25 text-white shadow-lg\"\n                            : \"border-white/15 bg-white/5 text-emerald-100/80 hover:border-emerald-200/50 hover:bg-white/10\"\n                        }`}\n                      >\n                        <div className=\"font-semibold text-white/90\">{title}</div>\n                        <div className=\"text-xs uppercase tracking-[0.3em] text-emerald-100/60\">Thread #{thread.id}</div>\n                      </button>\n                    );\n                  })}\n                </div>\n              )}\n            </>\n          ) : (\n            <div className=\"rounded-2xl border border-white/15 bg-white/5 p-4 text-center text-sm text-emerald-100/80\">\n              Tap “Show history” to browse your previous conversations.\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex flex-col gap-5 rounded-3xl border border-white/15 bg-white/10 p-5 shadow-[0_28px_110px_-60px_rgba(16,185,129,0.7)] backdrop-blur-xl\">\n          <div className=\"flex flex-col gap-1\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-sm font-semibold uppercase tracking-[0.3em] text-emerald-100\">\n                {selectedThread ? normalizeThreadTitle(selectedThread, 0) : \"Conversation\"}\n              </h2>\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => tenantId && selectedThreadId && loadMessages(tenantId, selectedThreadId)}\n                  disabled={!tenantId || !selectedThreadId || isLoadingMessages}\n                >\n                  Refresh\n                </Button>\n              </div>\n            </div>\n            <p className=\"text-xs text-emerald-100/70\">\n              The assistant uses safe, read-only queries. Ask for sales summaries, inventory gaps, or staff\n              performance insights.\n            </p>\n          </div>\n\n          <div className=\"flex-1 overflow-hidden rounded-3xl border border-white/15 bg-white/5\">\n            {isLoadingMessages ? (\n              <div className=\"p-4 space-y-3\">\n                {Array.from({ length: 5 }).map((_, index) => (\n                  <Skeleton key={index} className=\"h-16 w-full\" />\n                ))}\n              </div>\n            ) : !selectedThreadId ? (\n              <div className=\"flex h-full items-center justify-center p-6 text-sm text-emerald-100/70\">\n                Select a conversation to view messages.\n              </div>\n            ) : messages.length === 0 ? (\n              <div className=\"flex h-full items-center justify-center p-6 text-sm text-emerald-100/70\">\n                Ask your first question to begin.\n              </div>\n            ) : (\n              <div className=\"flex h-[55vh] flex-col gap-3 overflow-y-auto p-4 pr-6\">\n                {messages.map((message) => {\n                  const roleClass = ROLE_TONE[message.role] || ROLE_TONE.assistant;\n                  const label = ROLE_LABELS[message.role] || message.role;\n                  const assistantPayload =\n                    message.role === \"assistant\" ? parseAssistantPayload(message.content) : null;\n                  return (\n                    <div\n                      key={message.id}\n                      className={`flex ${\n                        message.role === \"assistant\" ? \"justify-start\" : \"justify-end\"\n                      }`}\n                    >\n                      <div\n                        className={`max-w-xl rounded-2xl px-3 py-2 text-sm shadow ${roleClass}`}\n                      >\n                        <div className=\"mb-1 text-xs font-semibold uppercase tracking-wide opacity-70\">\n                          {label}\n                        </div>\n                        {assistantPayload ? (\n                          <AssistantContent payload={assistantPayload} />\n                        ) : (\n                          <p className=\"whitespace-pre-wrap leading-relaxed\">\n                            {message.content}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n                {assistantThinking && (\n                  <div className=\"flex justify-start\">\n                    <div className=\"max-w-xs rounded-2xl border border-white/20 bg-white/80 px-3 py-2 text-sm text-emerald-800 shadow\">\n                      Assistant is analysing your data…\n                    </div>\n                  </div>\n                )}\n                <div ref={messagesEndRef} />\n              </div>\n            )}\n          </div>\n\n          <form\n            className=\"flex flex-col gap-3 rounded-3xl border border-white/15 bg-white/10 p-4 backdrop-blur-xl\"\n          >\n            <div className=\"flex items-center justify-between text-xs font-semibold uppercase tracking-[0.3em] text-emerald-100/80\">\n              <span>Ask a question</span>\n              <span className={`tracking-normal ${isOverLimit ? \"text-red-300\" : \"text-emerald-200\"}`}>\n                {remaining >= 0 ? `${remaining} characters left` : `${Math.abs(remaining)} over limit`}\n              </span>\n            </div>\n            <textarea\n              className=\"min-h-[120px] w-full resize-y rounded-2xl border border-white/15 bg-white/10 p-3 text-sm text-emerald-100/90 shadow-inner backdrop-blur focus:border-emerald-300/60 focus:outline-none focus:ring-2 focus:ring-emerald-200/40\"\n              placeholder=\"e.g. Show me the top selling medicines this week\"\n              value={messageDraft}\n              maxLength={MAX_PROMPT_LENGTH + 100}\n              onChange={(event) => setMessageDraft(event.target.value)}\n              onKeyDown={handleComposerKeyDown}\n            />\n            <Button onClick={handleSendMessage} disabled={!tenantId || !selectedThreadId || sending || isOverLimit}>\n              {sending ? \"Sending…\" : \"Send\"}\n            </Button>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}