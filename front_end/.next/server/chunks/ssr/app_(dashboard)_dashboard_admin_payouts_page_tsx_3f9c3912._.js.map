{"version":3,"sources":["turbopack:///[project]/app/(dashboard)/dashboard/admin/payouts/page.tsx"],"sourcesContent":["\"use client\";\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/components/ui/toast\";\nimport { AdminAPI, AuthAPI } from \"@/utils/api\";\n\ntype Payout = {\n  id: number;\n  affiliate_user_id: number;\n  tenant_id?: string | null;\n  month?: string | null;\n  percent?: number | null;\n  amount: number;\n  status: string;\n};\n\nexport default function AdminPayoutsPage() {\n  const { show } = useToast();\n  const [meLoading, setMeLoading] = useState(true);\n  const [me, setMe] = useState<any>(null);\n\n  const [loading, setLoading] = useState(true);\n  const [rows, setRows] = useState<Payout[]>([]);\n  const [q, setQ] = useState(\"\");\n  const [status, setStatus] = useState<string>(\"\");\n\n  useEffect(() => {\n    let active = true;\n    (async function loadMe() {\n      try { const m = await AuthAPI.me(); if (active) setMe(m); } finally { if (active) setMeLoading(false); }\n    })();\n    return () => { active = false };\n  }, []);\n\n  async function loadPayouts() {\n    setLoading(true);\n    try {\n      const data = await AdminAPI.listAffiliatePayouts(status || undefined);\n      setRows(Array.isArray(data) ? data : []);\n    } catch (e:any) {\n      show({ variant: \"destructive\", title: \"Failed to load payouts\", description: e.message });\n    } finally { setLoading(false); }\n  }\n\n  useEffect(() => { loadPayouts(); }, [status]);\n\n  const filtered = useMemo(() => {\n    const query = q.trim().toLowerCase();\n    if (!query) return rows;\n    return rows.filter(r =>\n      String(r.id).toLowerCase().includes(query) ||\n      String(r.affiliate_user_id).toLowerCase().includes(query) ||\n      (r.tenant_id || \"\").toLowerCase().includes(query) ||\n      (r.month || \"\").toLowerCase().includes(query) ||\n      (r.status || \"\").toLowerCase().includes(query)\n    );\n  }, [rows, q]);\n\n  async function markPaid(id: number) {\n    try { await AdminAPI.markPayoutPaid(id); show({ variant: \"success\", title: \"Payout marked paid\" }); await loadPayouts(); }\n    catch(e:any){ show({ variant:\"destructive\", title:\"Mark paid failed\", description:e.message }); }\n  }\n\n  async function approve(id: number) {\n    try { await AdminAPI.approvePayout(id); show({ variant: \"success\", title: \"Payout approved\" }); await loadPayouts(); }\n    catch(e:any){ show({ variant:\"destructive\", title:\"Approve failed\", description:e.message }); }\n  }\n\n  if (meLoading || loading) {\n    return (\n      <div className=\"space-y-4\">\n        <Skeleton className=\"h-8 w-64\" />\n        <Skeleton className=\"h-10 w-full\" />\n        <div className=\"space-y-2\">{Array.from({ length: 8 }).map((_, i) => (<Skeleton key={i} className=\"h-14\" />))}</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-6\">\n      <div className=\"mx-auto max-w-7xl space-y-8\">\n        <div className=\"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm\">\n          <div className=\"flex items-center justify-between\">\n            <h1 className=\"text-3xl font-bold text-slate-900\">Affiliate Payouts</h1>\n            <div className=\"flex items-center gap-3\">\n              <select \n                className=\"rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-700 focus:border-emerald-500 focus:ring-emerald-500\" \n                value={status} \n                onChange={(e)=>setStatus(e.target.value)}\n              >\n                <option value=\"\">All Status</option>\n                <option value=\"pending\">Pending</option>\n                <option value=\"approved\">Approved</option>\n                <option value=\"paid\">Paid</option>\n              </select>\n              <Input \n                placeholder=\"Search payouts...\" \n                value={q} \n                onChange={(e)=>setQ(e.target.value)} \n                className=\"w-80 rounded-lg border-slate-300 bg-white text-slate-900 placeholder:text-slate-400 focus:border-emerald-500 focus:ring-emerald-500\" \n              />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"rounded-2xl border border-slate-200 bg-white shadow-sm\">\n          <div className=\"border-b border-slate-200 p-6\">\n            <h2 className=\"text-lg font-semibold text-slate-900\">All Payouts ({filtered.length})</h2>\n          </div>\n          \n          <div className=\"overflow-hidden\">\n            <div className=\"grid grid-cols-12 gap-4 border-b border-slate-100 bg-slate-50 p-4 text-sm font-medium text-slate-600\">\n              <div className=\"col-span-2\">Payout ID</div>\n              <div className=\"col-span-2\">Affiliate User</div>\n              <div className=\"col-span-2\">Amount</div>\n              <div className=\"col-span-1\">Percent</div>\n              <div className=\"col-span-2\">Month</div>\n              <div className=\"col-span-1\">Status</div>\n              <div className=\"col-span-2 text-right\">Actions</div>\n            </div>\n            \n            {filtered.length === 0 ? (\n              <div className=\"p-12 text-center\">\n                <div className=\"text-slate-400\">\n                  <svg className=\"mx-auto h-12 w-12 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\" />\n                  </svg>\n                </div>\n                <h3 className=\"text-lg font-medium text-slate-900 mb-1\">No payouts found</h3>\n                <p className=\"text-slate-500\">No affiliate payouts match your current filters.</p>\n              </div>\n            ) : (\n              <div className=\"divide-y divide-slate-100\">\n                {filtered.map((p)=> (\n                  <div key={p.id} className=\"grid grid-cols-12 gap-4 p-4 items-center hover:bg-slate-50 transition-colors\">\n                    <div className=\"col-span-2\">\n                      <div className=\"font-mono text-sm text-slate-900\">#{p.id}</div>\n                    </div>\n                    <div className=\"col-span-2\">\n                      <div className=\"text-slate-700\">User #{p.affiliate_user_id}</div>\n                    </div>\n                    <div className=\"col-span-2\">\n                      <div className=\"text-lg font-semibold text-slate-900\">${p.amount?.toFixed?.(2) ?? p.amount}</div>\n                    </div>\n                    <div className=\"col-span-1\">\n                      <div className=\"text-slate-700\">{p.percent ? `${p.percent}%` : \"-\"}</div>\n                    </div>\n                    <div className=\"col-span-2\">\n                      <div className=\"text-slate-700\">{p.month || \"-\"}</div>\n                    </div>\n                    <div className=\"col-span-1\">\n                      <span className={`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${\n                        p.status===\"pending\" ? \"bg-amber-100 text-amber-800 border border-amber-200\" :\n                        p.status===\"approved\" ? \"bg-emerald-100 text-emerald-800 border border-emerald-200\" :\n                        \"bg-blue-100 text-blue-800 border border-blue-200\"\n                      }`}>\n                        {p.status}\n                      </span>\n                    </div>\n                    <div className=\"col-span-2 flex justify-end gap-2\">\n                      {p.status === \"pending\" && (\n                        <Button \n                          variant=\"outline\" \n                          size=\"sm\"\n                          onClick={()=>approve(p.id)}\n                          className=\"rounded-lg border-slate-300 bg-white text-slate-700 hover:bg-slate-50\"\n                        >\n                          Approve\n                        </Button>\n                      )}\n                      {p.status !== \"paid\" && (\n                        <Button \n                          size=\"sm\"\n                          onClick={()=>markPaid(p.id)}\n                          className=\"rounded-lg bg-emerald-600 text-white hover:bg-emerald-700\"\n                        >\n                          Mark Paid\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}