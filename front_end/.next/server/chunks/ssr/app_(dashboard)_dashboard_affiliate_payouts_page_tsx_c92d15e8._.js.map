{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/habtamusemagn/Desktop/last/gugu-gaga-/front_end/app/%28dashboard%29/dashboard/affiliate/payouts/page.tsx"],"sourcesContent":["\"use client\"\nimport { motion } from \"framer-motion\";\nimport { StatCard, SectionCard, MiniStat } from \"@/app/(dashboard)/dashboard/affiliate/_components/cards\";\nimport { useMemo, useState } from \"react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/components/ui/toast\";\nimport { AffiliateAPI } from \"@/utils/api\";\ntype Dashboard = {\n  referrals_count: number;\n  amount: number;\n  percent: number;\n  year: number;\n  month: number;\n  tenants: string[];\n  payouts: { pending_total: number; paid_total: number };\n};\n\ntype LinkItem = { token: string; url: string; active: boolean };\n\nfunction formatCurrency(amount: number) {\n  return new Intl.NumberFormat(\"en-US\", { style: \"currency\", currency: \"USD\" }).format(amount || 0);\n}\nexport default function Payouts() {\n  const { show } = useToast();\n  const [canCreateMore, setCanCreateMore] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [links, setLinks] = useState<LinkItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [requestingPayout, setRequestingPayout] = useState(false);\n  const [dash, setDash] = useState<Dashboard | null>(null);\n  const [payoutMonth, setPayoutMonth] = useState(\"\");\n  const tenantsCount = dash?.tenants?.length ?? 0;\n  const [payoutPercent, setPayoutPercent] = useState<number>(5);\n  const canRequestPayout = (dash?.amount ?? 0) > 0;\n  const payoutGuardMessage = \"You haven't earned any commission yet. Share your referral link to start earning before requesting a payout.\";\n  const currentPeriodLabel = useMemo(() => {\n    if (!dash?.month || !dash?.year) return \"current period\";\n    try {\n      return new Date(dash.year, dash.month - 1).toLocaleDateString(\"en-US\", {\n        month: \"long\",\n        year: \"numeric\",\n      });\n    } catch {\n      return `${dash.year}-${String(dash.month).padStart(2, \"0\")}`;\n    }\n  }, [dash?.month, dash?.year]);\n  async function refreshAll() {\n    setLoading(true);\n    try {\n      const [d, l] = await Promise.all([\n        AffiliateAPI.dashboard(),\n        AffiliateAPI.getLinks(),\n      ]);\n      const dashData = d as Dashboard;\n      setDash(dashData);\n      if (dashData?.year && dashData?.month) {\n        const monthStr = `${dashData.year}-${String(dashData.month).padStart(2, \"0\")}`;\n        setPayoutMonth(monthStr);\n      }\n      if (dashData?.percent) {\n        setPayoutPercent(dashData.percent);\n      }\n      setLinks((l as any).links || []);\n      setCanCreateMore(Boolean((l as any).can_create_more));\n      setError(null);\n    } catch (e: any) {\n      setError(e.message || \"Failed to load affiliate data\");\n      show({ variant: \"destructive\", title: \"Error\", description: e.message || \"Failed to load\" });\n    } finally {\n      setLoading(false);\n    }\n  }\n  async function onRequestPayout() {\n    if (!payoutMonth) {\n      show({ variant: \"destructive\", title: \"Missing month\", description: \"Select a month to request payment for.\" });\n      return;\n    }\n    if (!canRequestPayout) {\n      show({ variant: \"default\", title: \"No earnings yet\", description: payoutGuardMessage });\n      return;\n    }\n    setRequestingPayout(true);\n    try {\n      await AffiliateAPI.requestPayout(payoutMonth, payoutPercent || 5);\n      show({ variant: \"success\", title: \"Payout requested\", description: \"We will review and notify you once processed.\" });\n      await refreshAll();\n    } catch (e: any) {\n      show({ variant: \"destructive\", title: \"Failed to request payout\", description: e.message || \"Try again later\" });\n    } finally {\n      setRequestingPayout(false);\n    }\n  }\n  return <div><div className=\"grid gap-6 lg:grid-cols-2\">\n    <motion.div\n      initial={{ opacity: 0, y: 22 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.45, delay: 0.12, ease: \"easeOut\" }}\n    >\n      <SectionCard\n        title=\"This period at a glance\"\n        description={`Commission summary for ${currentPeriodLabel}.`}\n      >\n        <div className=\"grid gap-3 sm:grid-cols-3\">\n          <MiniStat label=\"Percent\" value={`${dash?.percent ?? 5}%`} />\n          <MiniStat label=\"Commission\" value={formatCurrency(dash?.amount || 0)} />\n          <MiniStat label=\"Referred Pharmacies\" value={tenantsCount.toString()} />\n        </div>\n        <div className=\"mt-6 rounded-2xl border border-emerald-100/30 bg-emerald-500/5 p-4\">\n          <p className=\"text-[11px] font-semibold uppercase tracking-widest text-emerald-600/80\">\n            Tenant IDs credited\n          </p>\n          <div className=\"mt-3 max-h-40 overflow-auto rounded-xl border border-white/10 p-3 text-white text-xs font-mono shadow-inner\">\n            {(dash?.tenants || []).length === 0 ? (\n              <p>No pharmacies referred yet this month. Share your link to get started.</p>\n            ) : (\n              <ul className=\"space-y-2\">\n                {dash?.tenants?.map((tenant) => (\n                  <li key={tenant} className=\"flex items-center justify-between\">\n                    <span>{tenant}</span>\n                    <span className=\"rounded-full bg-emerald-500/15 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-widest text-emerald-600\">Credited</span>\n                  </li>\n                ))}\n              </ul>\n            )}\n          </div>\n        </div>\n      </SectionCard>\n    </motion.div>\n\n    <motion.div\n      initial={{ opacity: 0, y: 22 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.45, delay: 0.16, ease: \"easeOut\" }}\n    >\n      <SectionCard\n        title=\"Request payout\"\n        description=\"Submit a commission payout request for a specific month.\"\n      >\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <label className=\"text-[11px] font-semibold uppercase tracking-widest text-white\">\n              Month (YYYY-MM)\n            </label>\n            <Input\n              value={payoutMonth}\n              onChange={(e) => setPayoutMonth(e.target.value)}\n              placeholder=\"2025-10\"\n              className=\"rounded-2xl border border-emerald-100/40 bg-white/80 text-emerald-900 placeholder:text-emerald-300 focus:border-emerald-400 focus:ring-emerald-400\"\n            />\n          </div>\n          <div className=\"space-y-2\">\n            <label className=\"text-[11px] font-semibold uppercase tracking-widest text-white\">\n              Commission percent\n            </label>\n            <Input\n              type=\"number\"\n              min={1}\n              max={20}\n              step={0.5}\n              value={payoutPercent}\n              onChange={(e) => setPayoutPercent(Number(e.target.value))}\n              className=\"rounded-2xl border border-emerald-100/40 bg-white/80 text-emerald-900 focus:border-emerald-400 focus:ring-emerald-400\"\n            />\n          </div>\n        </div>\n        <Button\n          onClick={onRequestPayout}\n          disabled={requestingPayout || !canRequestPayout}\n          className=\"mt-6 h-11 w-full rounded-2xl bg-gradient-to-r from-emerald-500 to-blue-500 text-sm font-semibold text-white shadow-[0_15px_45px_-25px_rgba(16,185,129,0.65)] transition-transform hover:scale-[1.01] disabled:cursor-not-allowed disabled:opacity-60\"\n        >\n          {requestingPayout ? \"Submitting...\" : \"Submit payout request\"}\n        </Button>\n        {!canRequestPayout && (\n          <p className=\"mt-3 text-xs font-medium text-white\">\n            {payoutGuardMessage}\n          </p>\n        )}\n      </SectionCard>\n    </motion.div>\n  </div></div>\n}"],"names":[],"mappings":"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","debugId":null}}]
}