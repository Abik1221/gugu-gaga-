{"version":3,"sources":["turbopack:///[project]/app/(dashboard)/dashboard/admin/users/[id]/roles/page.tsx"],"sourcesContent":["\"use client\";\nimport React, { useEffect, useMemo, useState } from \"react\";\nimport { useParams } from \"next/navigation\";\nimport { API_BASE, getAccessToken, getAuthJSON } from \"@/utils/api\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/components/ui/toast\";\nimport Link from \"next/link\";\n\nexport default function UserRolesPage() {\n  const { show } = useToast();\n  const params = useParams();\n  const userId = (params?.id as string) || \"\";\n\n  const [loading, setLoading] = useState(true);\n  const [user, setUser] = useState<any | null>(null);\n  const [roles, setRoles] = useState<any[]>([]);\n  const [filter, setFilter] = useState(\"\");\n  const [assigning, setAssigning] = useState<string | null>(null);\n\n  useEffect(() => {\n    let active = true;\n    async function load() {\n      try {\n        await getAuthJSON(\"/auth/me\");\n        const token = getAccessToken();\n        const [uRes, rRes] = await Promise.all([\n          fetch(`${API_BASE}/admin/users/${encodeURIComponent(userId)}`, { headers: token ? { Authorization: `Bearer ${token}` } : {} }),\n          fetch(`${API_BASE}/admin/roles`, { headers: token ? { Authorization: `Bearer ${token}` } : {} }),\n        ]);\n        if (!uRes.ok) throw new Error(await uRes.text().catch(() => \"Failed to load user\"));\n        if (!rRes.ok) throw new Error(await rRes.text().catch(() => \"Failed to load roles\"));\n        const u = await uRes.json();\n        const r = await rRes.json();\n        if (!active) return;\n        setUser(u);\n        setRoles(Array.isArray(r) ? r : []);\n      } catch (e: any) {\n        if (!active) return;\n        show({ variant: \"destructive\", title: \"Failed to load\", description: e.message || \"\" });\n      } finally {\n        if (active) setLoading(false);\n      }\n    }\n    if (userId) load();\n    return () => { active = false };\n  }, [show, userId]);\n\n  const assignedIds = new Set<string>((user?.roles || []).map((ur: any) => String(ur.role?.id || ur.id)));\n  const filtered = useMemo(() => {\n    const q = filter.trim().toLowerCase();\n    let list = roles as any[];\n    if (q) list = list.filter((r)=> String(r.name||\"\").toLowerCase().includes(q));\n    return list;\n  }, [roles, filter]);\n\n  async function assign(roleId: string) {\n    setAssigning(roleId);\n    try {\n      const token = getAccessToken();\n      const res = await fetch(`${API_BASE}/admin/users/${encodeURIComponent(userId)}/assign-role`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...(token ? { Authorization: `Bearer ${token}` } : {}),\n        },\n        body: JSON.stringify({ role: roleId }),\n      });\n      if (!res.ok) throw new Error(await res.text().catch(()=>\"Failed to assign\"));\n      // Refresh user\n      const uRes = await fetch(`${API_BASE}/admin/users/${encodeURIComponent(userId)}`, { headers: token ? { Authorization: `Bearer ${token}` } : {} });\n      const u = await uRes.json();\n      setUser(u);\n      show({ variant: \"success\", title: \"Role assigned\" });\n    } catch (e: any) {\n      show({ variant: \"destructive\", title: \"Assign failed\", description: e.message || \"\" });\n    } finally {\n      setAssigning(null);\n    }\n  }\n\n  async function remove(roleId: string) {\n    setAssigning(roleId);\n    try {\n      const token = getAccessToken();\n      const res = await fetch(`${API_BASE}/admin/users/${encodeURIComponent(userId)}/remove-role`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...(token ? { Authorization: `Bearer ${token}` } : {}),\n        },\n        body: JSON.stringify({ role: roleId }),\n      });\n      if (!res.ok) throw new Error(await res.text().catch(()=>\"Failed to remove\"));\n      // Refresh user\n      const uRes = await fetch(`${API_BASE}/admin/users/${encodeURIComponent(userId)}`, { headers: token ? { Authorization: `Bearer ${token}` } : {} });\n      const u = await uRes.json();\n      setUser(u);\n      show({ variant: \"success\", title: \"Role removed\" });\n    } catch (e: any) {\n      show({ variant: \"destructive\", title: \"Remove failed\", description: e.message || \"\" });\n    } finally {\n      setAssigning(null);\n    }\n  }\n\n  if (loading) return <div className=\"space-y-4\"><Skeleton className=\"h-8 w-64\" /><div className=\"space-y-2\">{Array.from({ length: 6 }).map((_,i)=>(<Skeleton key={i} className=\"h-14\"/>))}</div></div>;\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h1 className=\"text-xl font-semibold\">User Roles</h1>\n        <Link href=\"/dashboard/admin/users\" className=\"text-sm border rounded px-2 py-1 hover:bg-gray-50\">Back</Link>\n      </div>\n\n      <div className=\"border rounded bg-white p-4\">\n        <div className=\"text-sm\"><span className=\"font-medium\">User:</span> {user?.username || \"-\"} ({user?.email || \"-\"})</div>\n        <div className=\"text-xs text-gray-600\">ID: {user?.id}</div>\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <div className=\"font-medium\">Available Roles</div>\n        <Input placeholder=\"Filter roles\" value={filter} onChange={(e)=>setFilter(e.target.value)} className=\"w-64\" />\n      </div>\n\n      <div className=\"border rounded bg-white divide-y\">\n        <div className=\"grid grid-cols-12 p-3 text-xs text-gray-600\">\n          <div className=\"col-span-4\">Role Name</div>\n          <div className=\"col-span-6\">ID</div>\n          <div className=\"col-span-2 text-right\">Action</div>\n        </div>\n        {filtered.map((r) => {\n          const rid = String(r.id);\n          const has = assignedIds.has(rid);\n          return (\n            <div key={rid} className=\"grid grid-cols-12 p-3 items-center\">\n              <div className=\"col-span-4\">{r.name}</div>\n              <div className=\"col-span-6 text-xs text-gray-600 truncate\">{rid}</div>\n              <div className=\"col-span-2 text-right\">\n                {has ? (\n                  <Button variant=\"outline\" disabled={assigning===rid} onClick={()=>remove(rid)}>\n                    {assigning===rid?\"Removing...\":\"Remove\"}\n                  </Button>\n                ) : (\n                  <Button disabled={assigning===rid} onClick={()=>assign(rid)}>\n                    {assigning===rid?\"Assigning...\":\"Assign\"}\n                  </Button>\n                )}\n              </div>\n            </div>\n          );\n        })}\n        {filtered.length===0 && <div className=\"p-6 text-gray-500\">No roles.</div>}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"+EACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,IACtB,GAAM,MAAE,CAAI,CAAE,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,IACnB,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAU,GAAQ,IAAiB,GAEnC,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAa,MACvC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAQ,EAAE,EACtC,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC/B,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAE1D,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,IAAI,GAAS,EACb,eAAe,IACb,GAAI,CACF,MAAM,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,YAClB,IAAM,EAAQ,CAAA,EAAA,EAAA,cAAc,AAAd,IACR,CAAC,EAAM,EAAK,CAAG,MAAM,QAAQ,GAAG,CAAC,CACrC,MAAM,CAAA,EAAG,EAAA,QAAQ,CAAC,aAAa,EAAE,mBAAmB,GAAA,CAAS,CAAE,CAAE,QAAS,EAAQ,CAAE,cAAe,CAAC,OAAO,EAAE,EAAA,CAAO,AAAC,EAAI,CAAC,CAAE,GAC5H,MAAM,CAAA,EAAG,EAAA,QAAQ,CAAC,YAAY,CAAC,CAAE,CAAE,QAAS,EAAQ,CAAE,cAAe,CAAC,OAAO,EAAE,EAAA,CAAO,AAAC,EAAI,CAAC,CAAE,GAC/F,EACD,GAAI,CAAC,EAAK,EAAE,CAAE,MAAM,AAAI,MAAM,MAAM,EAAK,IAAI,GAAG,KAAK,CAAC,IAAM,wBAC5D,GAAI,CAAC,EAAK,EAAE,CAAE,MAAM,AAAI,MAAM,MAAM,EAAK,IAAI,GAAG,KAAK,CAAC,IAAM,yBAC5D,IAAM,EAAI,MAAM,EAAK,IAAI,GACnB,EAAI,MAAM,EAAK,IAAI,GACzB,GAAI,CAAC,EAAQ,OACb,EAAQ,GACR,EAAS,MAAM,OAAO,CAAC,GAAK,EAAI,EAAE,CACpC,CAAE,MAAO,EAAQ,CACf,GAAI,CAAC,EAAQ,OACb,EAAK,CAAE,QAAS,cAAe,MAAO,iBAAkB,YAAa,EAAE,OAAO,EAAI,EAAG,EACvF,QAAU,CACJ,GAAQ,GAAW,EACzB,CACF,CAEA,OADI,GAAQ,IACL,KAAQ,GAAS,CAAM,CAChC,EAAG,CAAC,EAAM,EAAO,EAEjB,IAAM,EAAc,IAAI,IAAY,CAAC,GAAM,OAAS,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,GAAY,OAAO,EAAG,IAAI,EAAE,IAAM,EAAG,EAAE,IAC9F,EAAW,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,KACvB,IAAM,EAAI,EAAO,IAAI,GAAG,WAAW,GAC/B,EAAO,EAEX,OADI,IAAG,EAAO,EAAK,MAAM,CAAC,AAAC,GAAK,OAAO,EAAE,IAAI,EAAE,IAAI,WAAW,GAAG,QAAQ,CAAC,GAAA,EACnE,CACT,EAAG,CAAC,EAAO,EAAO,EAElB,eAAe,EAAO,CAAc,EAClC,EAAa,GACb,GAAI,CACF,IAAM,EAAQ,CAAA,EAAA,EAAA,cAAA,AAAc,IACtB,EAAM,MAAM,MAAM,CAAA,EAAG,EAAA,QAAQ,CAAC,aAAa,EAAE,mBAAmB,GAAQ,YAAY,CAAC,CAAE,CAC3F,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,GAAI,EAAQ,CAAE,cAAe,CAAC,OAAO,EAAE,EAAA,CAAQ,AAAD,EAAK,CAAC,CAAC,AACvD,EACA,KAAM,KAAK,SAAS,CAAC,CAAE,KAAM,CAAO,EACtC,GACA,GAAI,CAAC,EAAI,EAAE,CAAE,MAAU,AAAJ,MAAU,MAAM,EAAI,IAAI,GAAG,KAAK,CAAC,IAAI,qBAExD,IAAM,EAAO,MAAM,MAAM,CAAA,EAAG,EAAA,QAAQ,CAAC,aAAa,EAAE,mBAAmB,GAAA,CAAS,CAAE,CAAE,QAAS,EAAQ,CAAE,cAAe,CAAC,OAAO,EAAE,EAAA,CAAO,AAAC,EAAI,CAAC,CAAE,GACzI,EAAI,MAAM,EAAK,IAAI,GACzB,EAAQ,GACR,EAAK,CAAE,QAAS,UAAW,MAAO,eAAgB,EACpD,CAAE,MAAO,EAAQ,CACf,EAAK,CAAE,QAAS,cAAe,MAAO,gBAAiB,YAAa,EAAE,OAAO,EAAI,EAAG,EACtF,QAAU,CACR,EAAa,KACf,CACF,CAEA,eAAe,EAAO,CAAc,EAClC,EAAa,GACb,GAAI,CACF,IAAM,EAAQ,CAAA,EAAA,EAAA,cAAA,AAAc,IACtB,EAAM,MAAM,MAAM,CAAA,EAAG,EAAA,QAAQ,CAAC,aAAa,EAAE,mBAAmB,GAAQ,YAAY,CAAC,CAAE,CAC3F,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,GAAI,EAAQ,CAAE,cAAe,CAAC,OAAO,EAAE,EAAA,CAAO,AAAC,EAAI,CAAC,CAAC,AACvD,EACA,KAAM,KAAK,SAAS,CAAC,CAAE,KAAM,CAAO,EACtC,GACA,GAAI,CAAC,EAAI,EAAE,CAAE,MAAM,AAAI,MAAM,MAAM,EAAI,IAAI,GAAG,KAAK,CAAC,IAAI,qBAExD,IAAM,EAAO,MAAM,MAAM,CAAA,EAAG,EAAA,QAAQ,CAAC,aAAa,EAAE,mBAAmB,GAAA,CAAS,CAAE,CAAE,QAAS,EAAQ,CAAE,cAAe,CAAC,OAAO,EAAE,EAAA,CAAO,AAAC,EAAI,CAAC,CAAE,GACzI,EAAI,MAAM,EAAK,IAAI,GACzB,EAAQ,GACR,EAAK,CAAE,QAAS,UAAW,MAAO,cAAe,EACnD,CAAE,MAAO,EAAQ,CACf,EAAK,CAAE,QAAS,cAAe,MAAO,gBAAiB,YAAa,EAAE,OAAO,EAAI,EAAG,EACtF,QAAU,CACR,EAAa,KACf,CACF,QAEA,AAAI,EAAgB,CAAA,EAAA,EAAA,EAAP,EAAO,EAAC,MAAA,CAAI,UAAU,sBAAY,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,UAAU,aAAa,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBAAa,MAAM,IAAI,CAAC,CAAE,OAAQ,CAAE,GAAG,GAAG,CAAC,CAAC,EAAE,IAAK,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAS,UAAU,QAAb,SAG/J,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,iCAAwB,eACtC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAK,yBAAyB,UAAU,6DAAoD,YAGpG,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wCACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oBAAU,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,uBAAc,UAAY,IAAE,GAAM,UAAY,IAAI,KAAG,GAAM,OAAS,IAAI,OACjH,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kCAAwB,OAAK,GAAM,SAGpD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uBAAc,oBAC7B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,YAAY,eAAe,MAAO,EAAQ,SAAU,AAAC,GAAI,EAAU,EAAE,MAAM,CAAC,KAAK,EAAG,UAAU,YAGvG,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,6CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wDACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBAAa,cAC5B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBAAa,OAC5B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAwB,cAExC,EAAS,GAAG,CAAC,AAAC,IACb,IAAM,EAAM,OAAO,EAAE,EAAE,EACjB,EAAM,EAAY,GAAG,CAAC,GAC5B,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAc,UAAU,+CACvB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sBAAc,EAAE,IAAI,GACnC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qDAA6C,IAC5D,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCACZ,EACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,QAAQ,UAAU,SAAU,IAAY,EAAK,QAAS,IAAI,EAAO,YACtE,IAAY,EAAI,cAAc,WAGjC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,SAAU,IAAY,EAAK,QAAS,IAAI,EAAO,YACpD,IAAY,EAAI,eAAe,eAV9B,EAgBd,GACC,AAAkB,MAAT,MAAM,EAAQ,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,6BAAoB,mBAInE"}