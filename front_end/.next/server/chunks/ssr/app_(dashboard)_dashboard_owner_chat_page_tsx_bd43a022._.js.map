{"version":3,"sources":["turbopack:///[project]/app/(dashboard)/dashboard/owner/chat/page.tsx"],"sourcesContent":["\"use client\";\nimport React, { useEffect, useState } from \"react\";\nimport Link from \"next/link\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/components/ui/toast\";\nimport { AuthAPI, ChatAPI, PharmaciesAPI } from \"@/utils/api\";\n\nexport default function ChatThreadsPage() {\n  const { show } = useToast();\n  const [loading, setLoading] = useState(true);\n  const [tenantId, setTenantId] = useState<string | null>(null);\n  const [pharmacies, setPharmacies] = useState<any[]>([]);\n  const [threads, setThreads] = useState<Array<{ id: number; title: string }>>(\n    []\n  );\n  const [title, setTitle] = useState(\"\");\n  const [error, setError] = useState<string | null>(null);\n\n  async function refresh(tid: string) {\n    setLoading(true);\n    try {\n      const rows = await ChatAPI.listThreads(tid);\n      setThreads(rows || []);\n      setError(null);\n    } catch (e: any) {\n      setError(e.message || \"Failed to load threads\");\n      show({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: e.message || \"Failed\",\n      });\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const me = await AuthAPI.me();\n        const ph = await PharmaciesAPI.list(1, 100);\n        const items = ph?.items || [];\n        setPharmacies(items);\n        const defaultTid = me?.tenant_id || (items[0]?.tenant_id ?? null);\n        if (defaultTid) {\n          setTenantId(defaultTid);\n          await refresh(defaultTid);\n        } else {\n          setError(\"No tenant context\");\n          setLoading(false);\n        }\n      } catch (e: any) {\n        setError(e.message || \"Failed\");\n        setLoading(false);\n      }\n    })();\n  }, []);\n\n  async function createThread() {\n    if (!tenantId) return;\n    try {\n      const t = title.trim() || \"New chat\";\n      await ChatAPI.createThread(tenantId, t);\n      setTitle(\"\");\n      await refresh(tenantId);\n    } catch (e: any) {\n      show({\n        variant: \"destructive\",\n        title: \"Create failed\",\n        description: e.message,\n      });\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"rounded-lg border border-slate-200 bg-white p-4 shadow-sm\">\n        <div className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\n          <h1 className=\"text-lg font-semibold text-slate-900\">Chat Threads</h1>\n          <div className=\"flex flex-wrap gap-2 items-center\">\n            <Input\n              placeholder=\"Ask about your business data...\"\n              value={title}\n              onChange={(e) => setTitle(e.target.value)}\n              className=\"w-64 border-slate-300 focus:border-emerald-500\"\n            />\n            <Button \n              onClick={createThread} \n              disabled={!tenantId}\n              size=\"sm\"\n              className=\"bg-emerald-700 hover:bg-emerald-800 text-white\"\n            >\n              Start Chat\n            </Button>\n          </div>\n        </div>\n\n      </div>\n      \n      {loading ? (\n        <Skeleton className=\"h-32 rounded-lg\" />\n      ) : error ? (\n        <div className=\"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-800\">{error}</div>\n      ) : (\n        <div className=\"grid gap-2\">\n          {threads.map((t) => (\n            <Link\n              key={t.id}\n              href={`/dashboard/owner/chat/${t.id}`}\n              className=\"block rounded-lg border border-slate-200 bg-white p-3 transition hover:border-emerald-200 hover:bg-emerald-50\"\n            >\n              <div className=\"font-medium text-slate-900\">{t.title}</div>\n              <div className=\"text-xs text-slate-600\">Thread #{t.id}</div>\n            </Link>\n          ))}\n          {threads.length === 0 && (\n            <div className=\"rounded-lg border border-slate-200 bg-slate-50 p-4 text-center text-sm text-slate-600\">\n              No threads yet. Create your first chat thread.\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}