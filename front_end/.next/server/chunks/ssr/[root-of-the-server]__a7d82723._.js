module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},50944,(a,b,c)=>{b.exports=a.r(74137)},5522,a=>{"use strict";a.s(["Input",()=>c]);var b=a.i(90944);let c=a.i(72131).forwardRef(({className:a="",...c},d)=>(0,b.jsx)("input",{ref:d,className:"w-full border rounded px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-emerald-200 focus:border-emerald-400 "+a,...c}));c.displayName="Input"},50463,a=>{"use strict";a.s(["Skeleton",()=>c,"TableSkeletonRows",()=>d]);var b=a.i(90944);function c({className:a=""}){return(0,b.jsx)("div",{className:`animate-pulse bg-gray-200 rounded ${a}`})}function d({rows:a=6,cols:d=6}){return(0,b.jsx)("tbody",{children:Array.from({length:a}).map((a,e)=>(0,b.jsx)("tr",{className:"border-t",children:Array.from({length:d}).map((a,d)=>(0,b.jsx)("td",{className:"px-3 py-2",children:(0,b.jsx)(c,{className:"h-4 w-full"})},d))},e))})}},60480,a=>{"use strict";a.s(["default",()=>j]);var b=a.i(90944),c=a.i(72131),d=a.i(75320),e=a.i(40695),f=a.i(64037),g=a.i(50463),h=a.i(5522),i=a.i(50944);function j(){let a=(0,i.useRouter)(),{show:j}=(0,f.useToast)(),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)([]);function C(a){if(!a)return null;if(a.receipt_id)return String(a.receipt_id);if(a.receipt&&a.receipt.id)return String(a.receipt.id);if(Array.isArray(a.receipts)&&a.receipts.length>0){let b=a.receipts[0];if(b&&b.id)return String(b.id)}return null}function D(){let a=(0,d.getAccessToken)();return a?{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}:{"Content-Type":"application/json"}}function E(a){return(Array.isArray(a?.items)?a.items:[]).map(a=>({id:String(a.item_id),name:String(a.name||""),price:Number(a.unit_price||0),qty:Number(a.quantity||0)}))}async function F(a){let b=await fetch(`${d.API_BASE}/api/v1/pos/sessions/${a}/cart`,{headers:D()});b.ok&&r(E(await b.json()))}async function G(a,b,c){let e=await fetch(`${d.API_BASE}/api/v1/pos/sessions/${a}/cart`,{method:"POST",headers:D(),body:JSON.stringify({item_id:b,quantity:c})});if(!e.ok)return void j({variant:"destructive",title:"Cart update failed",description:await e.text().catch(()=>"")});r(E(await e.json()))}async function H(a,b){(await fetch(`${d.API_BASE}/api/v1/pos/sessions/${a}/cart/${encodeURIComponent(b)}`,{method:"DELETE",headers:D()})).ok&&await F(a)}async function I(){if(0!==q.length){try{s&&await (0,d.postAuthJSON)(`/api/v1/pos/sessions/${s}/clear`,{})}catch(a){}r([]),j({variant:"success",title:"Cart cleared"})}}(0,c.useEffect)(()=>{let a=!0;async function b(){try{let b=(0,d.getAccessToken)(),c={...b?{Authorization:`Bearer ${b}`}:{}},e=await fetch(`${d.API_BASE}/api/v1/admin/branches`,{headers:c});if(!e.ok)return;let f=await e.json();if(!a)return;Array.isArray(f)&&B(f)}catch{}}return async function b(){try{let b=await (0,d.getAuthJSON)("/api/v1/inventory/items"),c=Array.isArray(b?.items)?b.items.map(a=>({id:String(a.id??""),name:String(a.medicine_name??""),sku:String(a.sku??""),sale_price:Number(a.sell_price??0),stock_qty:Number(a.quantity??0)})):[];if(!a)return;l(c)}catch(b){if(!a)return;j({variant:"destructive",title:"Failed to load items",description:b.message||""}),l([])}finally{a&&n(!1)}}(),b(),()=>{a=!1}},[j]);let J=(0,c.useMemo)(()=>{let a=o.trim().toLowerCase();return a?k.filter(b=>b.name.toLowerCase().includes(a)||b.sku.toLowerCase().includes(a)):k},[k,o]);async function K(a){let b=await P();b?await G(b,a.id,1):r(b=>b.find(b=>b.id===a.id)?b.map(b=>b.id===a.id?{...b,qty:b.qty+1}:b):[...b,{id:a.id,name:a.name,price:a.sale_price,qty:1}])}async function L(a){s&&await H(s,a),r(b=>b.filter(b=>b.id!==a))}async function M(a,b){if(b<=0)return L(a);let c=await P();c&&await G(c,a,b),r(c=>c.map(c=>c.id===a?{...c,qty:b}:c))}let N=(0,c.useMemo)(()=>q.reduce((a,b)=>a+b.price*b.qty,0),[q]),O=N+0;async function P(){if(s)return s;try{let a=await (0,d.getAuthJSON)("/api/v1/auth/me"),b={cashier_id:a?.id};y.trim()&&(b.branch_id=y.trim());let c=await (0,d.postAuthJSON)("/api/v1/pos/sessions",b),e=c?.id;if(e)return t(e),await F(e),e;return null}catch(a){return j({variant:"destructive",title:"Session creation failed",description:a.message||"Provide POS session schema to finalize"}),null}}async function Q(){if(0===q.length)return void j({variant:"destructive",title:"Cart is empty",description:"Add items to proceed"});if(w)return;x(!0);let b=await P();if(!b)return void x(!1);let c={items:q.map(a=>({item_id:a.id,quantity:a.qty}))};try{let e=await (0,d.postAuthJSON)(`/api/v1/pos/sessions/${b}/checkout`,c);j({variant:"success",title:"Checkout completed"}),r([]),v(e);let f=C(e);f&&a.push(`/dashboard/receipts/${f}`)}catch(b){let a=String(b?.message||"");j({variant:(a.includes("409"),"destructive"),title:"Checkout failed",description:a||"Please try again"})}x(!1)}return(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-6",children:[(0,b.jsxs)("section",{className:"col-span-12 md:col-span-7",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsx)("h1",{className:"text-xl font-semibold",children:"Point of Sale"}),m?(0,b.jsx)(g.Skeleton,{className:"h-9 w-64"}):(0,b.jsx)(h.Input,{value:o,onChange:a=>p(a.target.value),placeholder:"Search by name or SKU",className:"w-64"})]}),(0,b.jsx)("div",{className:"border rounded bg-white overflow-hidden",children:m?(0,b.jsx)("div",{className:"max-h-[520px] overflow-auto divide-y",children:Array.from({length:8}).map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Skeleton,{className:"h-4 w-48"}),(0,b.jsx)(g.Skeleton,{className:"h-3 w-32"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(g.Skeleton,{className:"h-4 w-16"}),(0,b.jsx)(g.Skeleton,{className:"h-9 w-20"})]})]},c))}):(0,b.jsxs)("div",{className:"max-h-[520px] overflow-auto divide-y",children:[J.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["SKU: ",a.sku]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"text-sm text-gray-700",children:["$",a.sale_price.toFixed(2)]}),(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>K(a),children:"Add"})]})]},a.id)),0===J.length&&(0,b.jsx)("div",{className:"p-6 text-gray-500",children:"No matching items."})]})})]}),(0,b.jsxs)("aside",{className:"col-span-12 md:col-span-5",children:[(0,b.jsxs)("div",{className:"border rounded bg-white",children:[(0,b.jsxs)("div",{className:"border-b p-3 font-medium flex items-center justify-between",children:[(0,b.jsx)("span",{children:"Cart"}),(0,b.jsx)("button",{className:"text-xs border rounded px-2 py-1 hover:bg-gray-50",onClick:()=>{t(null),j({variant:"success",title:"New session ready"})},children:"New Session"})]}),(0,b.jsxs)("div",{className:"p-3 border-b flex items-center gap-2",children:[(0,b.jsx)("div",{className:"text-xs text-gray-600",children:"Branch"}),(0,b.jsxs)("select",{value:y,onChange:a=>z(a.target.value),className:"border rounded px-2 py-2 text-sm w-80",children:[(0,b.jsx)("option",{value:"",children:"Select a branch"}),A.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Choose before creating a new session"})]}),m?(0,b.jsx)("div",{className:"divide-y max-h-[420px] overflow-auto",children:Array.from({length:4}).map((a,c)=>(0,b.jsxs)("div",{className:"p-3 flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0 space-y-2",children:[(0,b.jsx)(g.Skeleton,{className:"h-4 w-40"}),(0,b.jsx)(g.Skeleton,{className:"h-3 w-24"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Skeleton,{className:"h-9 w-20"}),(0,b.jsx)(g.Skeleton,{className:"h-4 w-12"}),(0,b.jsx)(g.Skeleton,{className:"h-9 w-24"})]})]},c))}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"divide-y max-h-[420px] overflow-auto",children:[q.map(a=>(0,b.jsxs)("div",{className:"p-3 flex items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("div",{className:"truncate",children:a.name}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["$",a.price.toFixed(2)," each"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Input,{type:"number",min:1,value:a.qty,onChange:b=>M(a.id,Number(b.target.value)),className:"w-20"}),(0,b.jsxs)("div",{className:"w-20 text-right font-medium",children:["$",(a.price*a.qty).toFixed(2)]}),(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>L(a.id),children:"Remove"})]})]},a.id)),0===q.length&&(0,b.jsx)("div",{className:"p-6 text-gray-500",children:"No items in cart."})]}),(0,b.jsxs)("div",{className:"border-t p-3 space-y-1 text-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Subtotal"}),(0,b.jsxs)("span",{children:["$",N.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,b.jsx)("span",{children:"Tax"}),(0,b.jsxs)("span",{children:["$","0.00"]})]}),(0,b.jsxs)("div",{className:"flex justify-between font-semibold",children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsxs)("span",{children:["$",O.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsx)(e.Button,{className:"flex-1",onClick:Q,disabled:w,children:w?"Processing...":"Checkout"}),(0,b.jsx)(e.Button,{variant:"outline",className:"w-36",onClick:I,children:"Clear Cart"})]})]})]})]}),u&&(0,b.jsx)("div",{className:"border rounded bg-white mt-4",children:(0,b.jsxs)("details",{children:[(0,b.jsx)("summary",{className:"cursor-pointer p-3 border-b font-medium",children:"Last Transaction"}),(0,b.jsxs)("div",{className:"p-3 space-y-2",children:[(0,b.jsx)("pre",{className:"text-xs overflow-auto max-h-64 bg-gray-50 p-2 rounded",children:JSON.stringify(u,null,2)}),C(u)&&(0,b.jsx)(e.Button,{onClick:()=>a.push(`/dashboard/receipts/${C(u)}`),children:"View Receipt"}),(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>v(null),children:"Clear"})]})]})})]})]})}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a7d82723._.js.map