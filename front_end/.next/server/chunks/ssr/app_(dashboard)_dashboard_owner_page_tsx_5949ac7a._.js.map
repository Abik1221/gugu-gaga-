{"version":3,"sources":["turbopack:///[project]/app/(dashboard)/dashboard/owner/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useCallback, useEffect, useMemo, useState } from \"react\";\nimport Link from \"next/link\";\n\nimport {\n  AuthAPI,\n  OwnerAnalyticsAPI,\n  type OwnerAnalyticsResponse,\n} from \"@/utils/api\";\nimport { useToast } from \"@/components/ui/toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  ResponsiveContainer,\n  AreaChart,\n  Area,\n  CartesianGrid,\n  Tooltip,\n  XAxis,\n  YAxis,\n} from \"recharts\";\n\ntype StaffActivityEntry = OwnerAnalyticsResponse[\"staff_activity\"][number];\n\nconst HORIZONS: { value: string; label: string }[] = [\n  { value: \"day\", label: \"24h\" },\n  { value: \"week\", label: \"7d\" },\n  { value: \"month\", label: \"30d\" },\n  { value: \"quarter\", label: \"90d\" },\n  { value: \"year\", label: \"12m\" },\n];\n\nconst DEFAULT_TREND_WEEKS = 12;\n\nfunction formatCurrency(value: number | undefined | null): string {\n  const num = Number(value ?? 0);\n  return `ETB ${num.toLocaleString(\"en-US\", { minimumFractionDigits: 0, maximumFractionDigits: 2 })}`;\n}\n\nfunction TrendPill({ delta }: { delta: number | undefined | null }) {\n  if (delta === undefined || delta === null || Number.isNaN(delta)) return null;\n  const positive = delta >= 0;\n  return (\n    <span\n      className={`inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold ${positive\n        ? \"bg-emerald-100 text-emerald-800\"\n        : \"bg-red-100 text-red-800\"\n        }`}\n    >\n      {positive ? \"▲\" : \"▼\"} {Math.abs(delta).toFixed(1)}%\n    </span>\n  );\n}\n\nfunction EmptyState({ title, description }: { title: string; description: string }) {\n  return (\n    <div className=\"flex flex-col items-center justify-center gap-3 rounded-2xl border border-slate-200 bg-slate-50 p-8 text-center text-sm text-slate-600\">\n      <div className=\"text-base font-semibold text-slate-800\">{title}</div>\n      <p className=\"max-w-sm text-xs leading-relaxed text-slate-600\">{description}</p>\n    </div>\n  );\n}\n\nexport default function OwnerDashboardPage() {\n  const { show } = useToast();\n\n  const [me, setMe] = useState<any>(null);\n  const [tenantId, setTenantId] = useState<string | null>(null);\n  const [loadingUser, setLoadingUser] = useState(true);\n  const [analyticsLoading, setAnalyticsLoading] = useState(true);\n  const [analyticsError, setAnalyticsError] = useState<string | null>(null);\n  const [analytics, setAnalytics] = useState<OwnerAnalyticsResponse | null>(null);\n  const [horizon, setHorizon] = useState<string>(\"month\");\n  const [trendWeeks, setTrendWeeks] = useState<number>(DEFAULT_TREND_WEEKS);\n\n  const loadAnalytics = useCallback(\n    async (tid: string, options?: { horizon?: string; trendWeeks?: number }) => {\n      setAnalyticsLoading(true);\n      setAnalyticsError(null);\n      try {\n        const data = await OwnerAnalyticsAPI.overview(tid, {\n          horizon: options?.horizon || horizon,\n          trendWeeks: options?.trendWeeks || trendWeeks,\n        });\n        setAnalytics(data);\n      } catch (error: any) {\n        setAnalytics(null);\n        setAnalyticsError(error?.message || \"Unable to load analytics data\");\n      } finally {\n        setAnalyticsLoading(false);\n      }\n    },\n    [horizon, trendWeeks],\n  );\n\n  useEffect(() => {\n    let active = true;\n    async function bootstrap() {\n      setLoadingUser(true);\n      try {\n        const profile = await AuthAPI.me();\n        if (!active) return;\n        \n        // Check flow status\n        if (profile?.kyc_status !== \"approved\") {\n          window.location.href = \"/dashboard/kyc\";\n          return;\n        }\n        if (profile?.subscription_status !== \"active\") {\n          window.location.href = \"/dashboard/payment\";\n          return;\n        }\n        \n        setMe(profile);\n        const tid = profile?.tenant_id || null;\n        setTenantId(tid);\n        if (tid) {\n          await loadAnalytics(tid);\n        }\n      } catch (error: any) {\n        if (!active) return;\n        setMe(null);\n        setTenantId(null);\n        setAnalytics(null);\n        setAnalyticsError(error?.message || \"You are not authorised to view this dashboard\");\n      } finally {\n        if (active) setLoadingUser(false);\n      }\n    }\n    bootstrap();\n    return () => {\n      active = false;\n    };\n  }, [loadAnalytics]);\n\n  const handleRefresh = async () => {\n    if (!tenantId) return;\n    await loadAnalytics(tenantId);\n    show({ variant: \"success\", title: \"Analytics refreshed\", description: \"Latest sales and inventory metrics are now visible.\" });\n  };\n\n  const handleHorizonChange = async (value: string) => {\n    if (value === horizon) return;\n    setHorizon(value);\n    if (tenantId) {\n      await loadAnalytics(tenantId, { horizon: value });\n    }\n  };\n\n  const handleTrendWeeksChange = async (weeks: number) => {\n    if (weeks === trendWeeks) return;\n    setTrendWeeks(weeks);\n    if (tenantId) {\n      await loadAnalytics(tenantId, { trendWeeks: weeks });\n    }\n  };\n\n  const revenueCards = useMemo(() => {\n    const totals = analytics?.totals;\n    const deltas = analytics?.deltas;\n    return [\n      {\n        label: \"Total revenue\",\n        value: formatCurrency(totals?.total_revenue),\n        delta: deltas?.revenue_vs_last_period,\n      },\n      {\n        label: \"Average ticket\",\n        value: formatCurrency(totals?.average_ticket),\n        delta: deltas?.avg_ticket_vs_last_period,\n      },\n      {\n        label: \"Units sold\",\n        value: (totals?.units_sold ?? 0).toLocaleString(\"en-US\"),\n        delta: deltas?.units_vs_last_period,\n      },\n      {\n        label: \"Completed sales\",\n        value: (totals?.sale_count ?? 0).toLocaleString(\"en-US\"),\n        delta: undefined,\n      },\n      {\n        label: \"Active cashiers\",\n        value: (totals?.active_cashiers ?? 0).toLocaleString(\"en-US\"),\n        delta: undefined,\n      },\n      {\n        label: \"Customers on file\",\n        value: (totals?.total_customers ?? 0).toLocaleString(\"en-US\"),\n        delta: undefined,\n      },\n      {\n        label: \"Active customers\",\n        value: (totals?.active_customers ?? 0).toLocaleString(\"en-US\"),\n        delta: undefined,\n      },\n      {\n        label: \"Upcoming refills (7d)\",\n        value: (totals?.upcoming_refills ?? 0).toLocaleString(\"en-US\"),\n        delta: undefined,\n      },\n    ];\n  }, [analytics]);\n\n  const activityStream: StaffActivityEntry[] = useMemo(() => {\n    return (analytics?.staff_activity || []).slice(0, 20);\n  }, [analytics]);\n\n  const revenueTrend = analytics?.revenue_trend || [];\n  const branchComparison = analytics?.branch_comparison || [];\n  const productivity = analytics?.staff_productivity || [];\n  const topProducts = analytics?.top_products || [];\n  const inventorySlices = analytics?.inventory_health || [];\n  const recentPayments = analytics?.recent_payments || [];\n\n  const loading = loadingUser || analyticsLoading;\n  const displayName = useMemo(() => {\n    if (!me) return \"owner\";\n    const firstName = (me.first_name || \"\").trim();\n    if (firstName) return firstName;\n    const fallback = (me.username || me.email || \"owner\").trim();\n    return fallback || \"owner\";\n  }, [me]);\n\n  return (\n    <div className=\"space-y-8\">\n      <header className=\"flex flex-col gap-4 rounded-2xl border border-slate-200 bg-white p-5 shadow-md lg:flex-row lg:items-center lg:justify-between\">\n        <div className=\"space-y-1\">\n          <h1 className=\"text-2xl font-semibold text-black\">\n            {loadingUser ? \"Loading...\" : `Welcome back, ${displayName}`}\n          </h1>\n          <p className=\"max-w-xl text-sm text-slate-900\">\n            Monitor revenue, compare branches, and coach your pharmacy team from a single command center.\n          </p>\n        </div>\n\n        <div className=\"flex flex-wrap items-center gap-3\">\n          {/* Horizon picker */}\n          <div className=\"flex rounded-full border border-slate-200 bg-white p-1 text-xs shadow-sm\">\n            {HORIZONS.map((item) => {\n              const active = horizon === item.value;\n              return (\n                <button\n                  key={item.value}\n                  type=\"button\"\n                  onClick={() => handleHorizonChange(item.value)}\n                  className={`rounded-full px-3 py-1 font-semibold transition ${active ? \"bg-emerald-700 text-white shadow-lg\" : \"text-slate-800 hover:bg-slate-100\"\n                    }`}\n                  disabled={analyticsLoading}\n                >\n                  {item.label}\n                </button>\n              );\n            })}\n          </div>\n\n          {/* Trend weeks */}\n          <select\n            value={trendWeeks}\n            onChange={(event) => handleTrendWeeksChange(Number(event.target.value) || DEFAULT_TREND_WEEKS)}\n            className=\"rounded-full border border-slate-200 bg-white px-3 py-1 text-xs font-semibold text-slate-800 shadow-sm focus-visible:ring-2 focus-visible:ring-emerald-200\"\n            disabled={analyticsLoading}\n          >\n            <option value={4}>4 weeks</option>\n            <option value={8}>8 weeks</option>\n            <option value={12}>12 weeks</option>\n            <option value={24}>24 weeks</option>\n          </select>\n\n          {/* Actions */}\n          <Button variant=\"outline\" size=\"sm\" onClick={handleRefresh} disabled={analyticsLoading || !tenantId}>\n            Refresh\n          </Button>\n\n          <Link href=\"/dashboard/owner/integrations\">\n            <Button variant=\"outline\" size=\"sm\">Connect tools</Button>\n          </Link>\n\n          <Link href=\"/dashboard/owner/staff/new\">\n            <Button size=\"sm\" className=\"bg-emerald-700 hover:bg-emerald-800 text-white shadow-md\">Invite staff</Button>\n          </Link>\n        </div>\n      </header>\n\n      {analyticsError && (\n        <div className=\"rounded border border-red-300 bg-red-100 p-3 text-sm text-red-800\">\n          {analyticsError}\n        </div>\n      )}\n\n      {/* Top metrics */}\n      <section className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 xl:grid-cols-5\">\n        {revenueCards.map((card) => (\n          <Card\n            key={card.label}\n            className=\"border border-slate-200 bg-white text-black shadow-md transition transform-gpu hover:-translate-y-0.5\"\n          >\n            <CardHeader className=\"space-y-2\">\n              <CardTitle className=\"text-xs uppercase tracking-wider text-slate-900\">{card.label}</CardTitle>\n              {loading ? (\n                <Skeleton className=\"h-8 w-24\" />\n              ) : (\n                <div className=\"text-2xl font-semibold text-black\">{card.value}</div>\n              )}\n              {!loading && <TrendPill delta={card.delta} />}\n            </CardHeader>\n          </Card>\n        ))}\n      </section>\n\n      {/* Revenue trend + Inventory */}\n      <section className=\"grid gap-6 lg:grid-cols-5\">\n        <Card className=\"lg:col-span-3 border border-slate-200 bg-white text-black shadow-md\">\n          <CardHeader className=\"flex flex-col gap-1 md:flex-row md:items-center md:justify-between\">\n            <CardTitle className=\"text-black\">Revenue trend</CardTitle>\n            <span className=\"text-xs font-semibold uppercase tracking-wider text-slate-900\">\n              {trendWeeks} week trajectory\n            </span>\n          </CardHeader>\n\n          <CardContent className=\"h-72\">\n            {loading ? (\n              <Skeleton className=\"h-full w-full\" />\n            ) : revenueTrend.length === 0 ? (\n              <EmptyState title=\"No sales recorded\" description=\"Capture a sale from the POS to start building your revenue history.\" />\n            ) : (\n              <ResponsiveContainer width=\"100%\" height=\"100%\">\n                <AreaChart data={revenueTrend} margin={{ top: 10, right: 16, bottom: 8, left: -4 }}>\n                  <defs>\n                    <linearGradient id=\"trendGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                      <stop offset=\"5%\" stopColor=\"#065f46\" stopOpacity={0.22} />\n                      <stop offset=\"95%\" stopColor=\"#065f46\" stopOpacity={0.06} />\n                    </linearGradient>\n                  </defs>\n                  <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e6eef4\" />\n                  <XAxis dataKey=\"period\" tickLine={false} axisLine={false} fontSize={12} />\n                  <YAxis\n                    tickFormatter={(val) => `ETB ${val.toLocaleString(\"en-US\", { maximumFractionDigits: 0 })}`}\n                    width={100}\n                    axisLine={false}\n                    tickLine={false}\n                    fontSize={12}\n                  />\n                  <Tooltip formatter={(value: number) => formatCurrency(value)} labelFormatter={(label) => label} />\n                  <Area type=\"monotone\" dataKey=\"revenue\" stroke=\"#065f46\" strokeWidth={2} fill=\"url(#trendGradient)\" />\n                </AreaChart>\n              </ResponsiveContainer>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2 border border-slate-200 bg-white text-black shadow-md\">\n          <CardHeader>\n            <CardTitle className=\"text-black\">Inventory health</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {loading ? (\n              <Skeleton className=\"h-32\" />\n            ) : inventorySlices.length === 0 ? (\n              <EmptyState title=\"No inventory audits\" description=\"Sync your inventory lots so owners know which medicines need attention.\" />\n            ) : (\n              inventorySlices.map((slice) => (\n                <div key={slice.label} className=\"flex items-center justify-between rounded-lg border border-slate-200 bg-white px-3 py-2\">\n                  <div className=\"text-sm font-medium text-slate-800\">{slice.label}</div>\n                  <span className=\"text-sm font-semibold text-emerald-700\">{slice.count}</span>\n                </div>\n              ))\n            )}\n          </CardContent>\n        </Card>\n      </section>\n\n      {/* Branch comparison + staff productivity */}\n      <section className=\"grid gap-6 lg:grid-cols-5\">\n        <Card className=\"lg:col-span-3 border border-slate-200 bg-white text-black shadow-md\">\n          <CardHeader className=\"flex flex-col gap-1 md:flex-row md:items-center md:justify-between\">\n            <CardTitle className=\"text-black\">Branch comparison</CardTitle>\n            <span className=\"text-xs font-semibold uppercase tracking-wider text-slate-900\">Revenue, transactions, and units sold</span>\n          </CardHeader>\n\n          <CardContent className=\"space-y-2 overflow-x-auto\">\n            {loading ? (\n              <Skeleton className=\"h-32\" />\n            ) : branchComparison.length === 0 ? (\n              <EmptyState title=\"No branches on record\" description=\"Add the branch field when creating sales to see how each site performs.\" />\n            ) : (\n              <table className=\"min-w-full divide-y divide-slate-200 text-sm text-slate-800\">\n                <thead className=\"bg-white\">\n                  <tr>\n                    <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-900\">Branch</th>\n                    <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-900\">Revenue</th>\n                    <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-900\">Sales</th>\n                    <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-900\">Units sold</th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-slate-100 bg-white\">\n                  {branchComparison.map((row) => (\n                    <tr key={row.branch ?? \"_default\"}>\n                      <td className=\"px-3 py-2\">{row.branch || \"Unassigned\"}</td>\n                      <td className=\"px-3 py-2 text-emerald-700\">{formatCurrency(row.revenue)}</td>\n                      <td className=\"px-3 py-2\">{row.sale_count.toLocaleString(\"en-US\")}</td>\n                      <td className=\"px-3 py-2\">{row.units_sold.toLocaleString(\"en-US\")}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2 border border-slate-200 bg-white text-black shadow-md\">\n          <CardHeader className=\"flex flex-col gap-1 md:flex-row md:items-center md:justify-between\">\n            <CardTitle className=\"text-black\">Staff productivity</CardTitle>\n            <Link href=\"/dashboard/owner/staff\" className=\"text-xs font-semibold text-emerald-700 hover:underline\">View staff list</Link>\n          </CardHeader>\n\n          <CardContent className=\"space-y-2\">\n            {loading ? (\n              <Skeleton className=\"h-32\" />\n            ) : productivity.length === 0 ? (\n              <EmptyState title=\"No staff sales captured\" description=\"Record a sale from the POS to start ranking your cashiers.\" />\n            ) : (\n              <ul className=\"space-y-2\">\n                {productivity.map((item) => {\n                  const fallback = item as typeof item & { transaction_count?: number; avg_ticket?: number; };\n                  const transactions = item.transactions ?? fallback.transaction_count ?? 0;\n                  const avgTicketValue = fallback.avg_ticket ?? (transactions ? item.total_sales / transactions : 0);\n\n                  return (\n                    <li key={item.user_id} className=\"rounded-lg border border-slate-200 bg-white px-3 py-2\">\n                      <div className=\"flex items-center justify-between text-sm font-semibold text-slate-800\">\n                        <span>{item.name}</span>\n                        <span className=\"text-emerald-700\">{formatCurrency(item.total_sales)}</span>\n                      </div>\n                      <div className=\"mt-1 text-xs text-slate-600\">\n                        {transactions.toLocaleString(\"en-US\")} sales • {formatCurrency(avgTicketValue)} avg ticket\n                      </div>\n                    </li>\n                  );\n                })}\n              </ul>\n            )}\n          </CardContent>\n        </Card>\n      </section>\n\n      {/* Staff activity + recent payments */}\n      <section className=\"grid gap-6 lg:grid-cols-5\">\n        <Card className=\"lg:col-span-3 border border-slate-200 bg-white text-black shadow-md\">\n          <CardHeader className=\"flex flex-col gap-1 md:flex-row md:items-center md:justify-between\">\n            <CardTitle className=\"text-black\">Staff activity</CardTitle>\n            <span className=\"text-xs font-semibold uppercase tracking-wider text-slate-900\">Most recent inventory & POS changes</span>\n          </CardHeader>\n\n          <CardContent className=\"space-y-3\">\n            {loading ? (\n              <Skeleton className=\"h-40\" />\n            ) : activityStream.length === 0 ? (\n              <EmptyState title=\"No recent activity\" description=\"Inventory updates, POS sales and staff audits will show here.\" />\n            ) : (\n              <ul className=\"space-y-2\">\n                {activityStream.map((entry) => (\n                  <li key={entry.id} className=\"rounded-lg border border-slate-200 bg-white p-3 text-sm\">\n                    <div className=\"flex items-center justify-between\">\n                      <span className=\"font-semibold text-slate-800\">{entry.action.replace(/_/g, \" \")}</span>\n                      <span className=\"text-xs text-slate-600\">{new Date(entry.created_at).toLocaleString()}</span>\n                    </div>\n                    <div className=\"mt-1 text-xs text-slate-700\">\n                      {(() => {\n                        const raw = entry as typeof entry & { description?: string };\n                        if (raw.description) return raw.description;\n                        if (entry.metadata) {\n                          try {\n                            return typeof entry.metadata === \"string\" ? entry.metadata : JSON.stringify(entry.metadata);\n                          } catch {\n                            return String(entry.metadata);\n                          }\n                        }\n                        return \"No additional details\";\n                      })()}\n                    </div>\n                  </li>\n                ))}\n              </ul>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card className=\"lg:col-span-2 border border-slate-200 bg-white text-black shadow-md\">\n          <CardHeader>\n            <CardTitle className=\"text-black\">Recent payment activity</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-2\">\n            {loading ? (\n              <Skeleton className=\"h-32\" />\n            ) : recentPayments.length === 0 ? (\n              <EmptyState title=\"No submissions yet\" description=\"Payment uploads appear here for the owner’s records.\" />\n            ) : (\n              <ul className=\"space-y-2 text-sm text-slate-800\">\n                {recentPayments.map((payment) => {\n                  const raw = payment as typeof payment & { amount_formatted?: string; amount?: number; method?: string; };\n                  const amountDisplay = raw.amount_formatted ?? (raw.amount != null ? formatCurrency(raw.amount) : \"—\");\n                  const methodDisplay = raw.method ?? \"N/A\";\n\n                  return (\n                    <li key={payment.id} className=\"rounded-lg border border-slate-200 bg-white px-3 py-2\">\n                      <div className=\"flex items-center justify-between text-xs text-slate-700\">\n                        <span className=\"font-semibold uppercase text-slate-800\">{payment.status_label || payment.status}</span>\n                        <span>{payment.created_at_formatted || new Date(payment.created_at).toLocaleString()}</span>\n                      </div>\n                      <div className=\"mt-1 text-xs text-slate-700\">\n                        {amountDisplay} • {methodDisplay}\n                      </div>\n                    </li>\n                  );\n                })}\n              </ul>\n            )}\n          </CardContent>\n        </Card>\n      </section>\n\n      {/* Top products */}\n      <section className=\"space-y-3\">\n        <Card className=\"border border-slate-200 bg-white text-black shadow-md\">\n          <CardHeader className=\"flex flex-col gap-1 md:flex-row md:items-center md:justify-between\">\n            <CardTitle className=\"text-black\">Top products</CardTitle>\n            <span className=\"text-xs font-semibold uppercase tracking-wider text-slate-900\">Most recent best sellers</span>\n          </CardHeader>\n          <CardContent>\n            {loading ? (\n              <Skeleton className=\"h-32\" />\n            ) : topProducts.length === 0 ? (\n              <EmptyState title=\"No product insights yet\" description=\"Run more sales through the POS to see which medicines drive revenue.\" />\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-slate-200 text-sm text-slate-800\">\n                  <thead className=\"bg-white\">\n                    <tr>\n                      <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-900\">Product</th>\n                      <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-900\">Revenue</th>\n                      <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-900\">Sales</th>\n                      <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-900\">Quantity</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-slate-100 bg-white\">\n                    {topProducts.map((item) => (\n                      <tr key={item.name}>\n                        <td className=\"px-3 py-2\">{item.name}</td>\n                        <td className=\"px-3 py-2 text-emerald-700\">{formatCurrency(item.revenue)}</td>\n                        <td className=\"px-3 py-2\">{item.quantity.toLocaleString(\"en-US\")}</td>\n                        <td className=\"px-3 py-2\">{item.quantity.toLocaleString(\"en-US\")}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </section>\n    </div>\n  );\n}\n\n//  <div className=\"space-y-8\">\n//       <header className=\"flex flex-col gap-4 rounded-2xl border border-slate-200 bg-white p-5 shadow-sm lg:flex-row lg:items-center lg:justify-between\">\n//         <div className=\"space-y-1\">\n//           <h1 className=\"text-2xl font-semibold text-black\">\n//             {loadingUser ? \"Loading...\" : `Welcome back, ${displayName}`}\n//           </h1>\n//           <p className=\"max-w-xl text-sm text-slate-600\">\n//             Monitor revenue, compare branches, and coach your pharmacy team from a single command center.\n//           </p>\n//         </div>\n\n//         <div className=\"flex flex-wrap items-center gap-3\">\n//           {/* Horizon picker */}\n//           <div className=\"flex rounded-full border border-slate-200 bg-white p-1 text-xs shadow-sm\">\n//             {HORIZONS.map((item) => {\n//               const active = horizon === item.value;\n//               return (\n//                 <button\n//                   key={item.value}\n//                   type=\"button\"\n//                   onClick={() => handleHorizonChange(item.value)}\n//                   className={`rounded-full px-3 py-1 font-semibold transition ${active\n//                       ? \"bg-emerald-700 text-white shadow\"\n//                       : \"text-slate-700 hover:bg-slate-50\"\n//                     }`}\n//                   disabled={analyticsLoading}\n//                 >\n//                   {item.label}\n//                 </button>\n//               );\n//             })}\n//           </div>\n\n{/* Trend weeks */ }\n// <select\n//   value={trendWeeks}\n//   onChange={(event) => handleTrendWeeksChange(Number(event.target.value) || DEFAULT_TREND_WEEKS)}\n//   className=\"rounded-full border border-slate-200 bg-white px-3 py-1 text-xs font-semibold text-slate-800 shadow-sm focus-visible:ring-2 focus-visible:ring-emerald-200\"\n//   disabled={analyticsLoading}\n// >\n//   <option value={4}>4 weeks</option>\n//   <option value={8}>8 weeks</option>\n//   <option value={12}>12 weeks</option>\n//   <option value={24}>24 weeks</option>\n// </select>\n\n{/* Actions */ }\n//     <Button variant=\"outline\" size=\"sm\" onClick={handleRefresh} disabled={analyticsLoading || !tenantId}>\n//       Refresh\n//     </Button>\n\n//     <Link href=\"/dashboard/owner/integrations\">\n//       <Button variant=\"outline\" size=\"sm\">Connect tools</Button>\n//     </Link>\n\n//     <Link href=\"/dashboard/owner/staff/new\">\n//       <Button size=\"sm\" className=\"bg-emerald-700 hover:bg-emerald-800 text-white\">Invite staff</Button>\n//     </Link>\n//   </div>\n// </header>\n\n// {analyticsError && (\n//   <div className=\"rounded border border-red-200 bg-red-50 p-3 text-sm text-red-700\">\n//     {analyticsError}\n//   </div>\n// )}\n\n{/* Top metrics */ }\n// <section className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 xl:grid-cols-5\">\n//   {revenueCards.map((card) => (\n//     <Card\n//       key={card.label}\n//       className=\"border border-slate-100 bg-white text-black shadow-sm transition hover:translate-y-0.5\"\n//     >\n//       <CardHeader className=\"space-y-2\">\n//         <CardTitle className=\"text-xs uppercase tracking-wider text-slate-600\">{card.label}</CardTitle>\n//         {loading ? (\n//           <Skeleton className=\"h-8 w-24\" />\n//         ) : (\n//           <div className=\"text-2xl font-semibold text-black\">{card.value}</div>\n//         )}\n//         {!loading && <TrendPill delta={card.delta} />}\n//       </CardHeader>\n//     </Card>\n//   ))}\n// </section>\n\n{/* Revenue trend + Inventory */ }\n// <section className=\"grid gap-6 lg:grid-cols-5\">\n//   <Card className=\"lg:col-span-3 border border-slate-100 bg-white text-black shadow-sm\">\n//     <CardHeader className=\"flex flex-col gap-1 md:flex-row md:items-center md:justify-between\">\n//       <CardTitle className=\"text-black\">Revenue trend</CardTitle>\n//       <span className=\"text-xs font-semibold uppercase tracking-wider text-slate-600\">\n//         {trendWeeks} week trajectory\n//       </span>\n//     </CardHeader>\n\n//     <CardContent className=\"h-72\">\n//       {loading ? (\n//         <Skeleton className=\"h-full w-full\" />\n//       ) : revenueTrend.length === 0 ? (\n//         <EmptyState\n//           title=\"No sales recorded\"\n//           description=\"Capture a sale from the POS to start building your revenue history.\"\n//         />\n//       ) : (\n//         <ResponsiveContainer width=\"100%\" height=\"100%\">\n//           <AreaChart data={revenueTrend} margin={{ top: 10, right: 16, bottom: 8, left: -4 }}>\n//             <defs>\n//               <linearGradient id=\"trendGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n//                 <stop offset=\"5%\" stopColor=\"#065f46\" stopOpacity={0.18} />\n//                 <stop offset=\"95%\" stopColor=\"#065f46\" stopOpacity={0.04} />\n//               </linearGradient>\n//             </defs>\n//             <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#f1f5f9\" />\n//             <XAxis dataKey=\"period\" tickLine={false} axisLine={false} fontSize={12} />\n//             <YAxis\n//               tickFormatter={(val) => `ETB ${val.toLocaleString(\"en-US\", { maximumFractionDigits: 0 })}`}\n//               width={90}\n//               axisLine={false}\n//               tickLine={false}\n//               fontSize={12}\n//             />\n//             <Tooltip formatter={(value: number) => formatCurrency(value)} labelFormatter={(label) => label} />\n//             <Area type=\"monotone\" dataKey=\"revenue\" stroke=\"#065f46\" strokeWidth={2} fill=\"url(#trendGradient)\" />\n//           </AreaChart>\n//         </ResponsiveContainer>\n//       )}\n//     </CardContent>\n//   </Card>\n\n//   <Card className=\"lg:col-span-2 border border-slate-100 bg-white text-black shadow-sm\">\n//     <CardHeader>\n//       <CardTitle className=\"text-black\">Inventory health</CardTitle>\n//     </CardHeader>\n//     <CardContent className=\"space-y-3\">\n//       {loading ? (\n//         <Skeleton className=\"h-32\" />\n//       ) : inventorySlices.length === 0 ? (\n//         <EmptyState\n//           title=\"No inventory audits\"\n//           description=\"Sync your inventory lots so owners know which medicines need attention.\"\n//         />\n//       ) : (\n//         inventorySlices.map((slice) => (\n//           <div key={slice.label} className=\"flex items-center justify-between rounded-lg border border-slate-100 bg-white px-3 py-2\">\n//             <div className=\"text-sm font-medium text-slate-800\">{slice.label}</div>\n//             <span className=\"text-sm font-semibold text-emerald-700\">{slice.count}</span>\n//           </div>\n//         ))\n//       )}\n//     </CardContent>\n//   </Card>\n// </section>\n\n{/* Branch comparison + staff productivity */ }\n// <section className=\"grid gap-6 lg:grid-cols-5\">\n//   <Card className=\"lg:col-span-3 border border-slate-100 bg-white text-black shadow-sm\">\n//     <CardHeader className=\"flex flex-col gap-1 md:flex-row md:items-center md:justify-between\">\n//       <CardTitle className=\"text-black\">Branch comparison</CardTitle>\n//       <span className=\"text-xs font-semibold uppercase tracking-wider text-slate-600\">Revenue, transactions, and units sold</span>\n//     </CardHeader>\n\n//     <CardContent className=\"space-y-2 overflow-x-auto\">\n//       {loading ? (\n//         <Skeleton className=\"h-32\" />\n//       ) : branchComparison.length === 0 ? (\n//         <EmptyState\n//           title=\"No branches on record\"\n//           description=\"Add the branch field when creating sales to see how each site performs.\"\n//         />\n//       ) : (\n//         <table className=\"min-w-full divide-y divide-slate-100 text-sm text-slate-800\">\n//           <thead className=\"bg-white\">\n//             <tr>\n//               <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-700\">Branch</th>\n//               <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-700\">Revenue</th>\n//               <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-700\">Sales</th>\n//               <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-700\">Units sold</th>\n//             </tr>\n//           </thead>\n//           <tbody className=\"divide-y divide-slate-100 bg-white\">\n//             {branchComparison.map((row) => (\n//               <tr key={row.branch ?? \"_default\"}>\n//                 <td className=\"px-3 py-2\">{row.branch || \"Unassigned\"}</td>\n//                 <td className=\"px-3 py-2 text-emerald-700\">{formatCurrency(row.revenue)}</td>\n//                 <td className=\"px-3 py-2\">{row.sale_count.toLocaleString(\"en-US\")}</td>\n//                 <td className=\"px-3 py-2\">{row.units_sold.toLocaleString(\"en-US\")}</td>\n//               </tr>\n//             ))}\n//           </tbody>\n//         </table>\n//       )}\n//     </CardContent>\n//   </Card>\n\n//   <Card className=\"lg:col-span-2 border border-slate-100 bg-white text-black shadow-sm\">\n//     <CardHeader className=\"flex flex-col gap-1 md:flex-row md:items-center md:justify-between\">\n//       <CardTitle className=\"text-black\">Staff productivity</CardTitle>\n//       <Link href=\"/dashboard/owner/staff\" className=\"text-xs font-semibold text-emerald-700 hover:underline\">View staff list</Link>\n//     </CardHeader>\n\n//     <CardContent className=\"space-y-2\">\n//       {loading ? (\n//         <Skeleton className=\"h-32\" />\n//       ) : productivity.length === 0 ? (\n//         <EmptyState\n//           title=\"No staff sales captured\"\n//           description=\"Record a sale from the POS to start ranking your cashiers.\"\n//         />\n//       ) : (\n//         <ul className=\"space-y-2\">\n//           {productivity.map((item) => {\n//             const fallback = item as typeof item & { transaction_count?: number; avg_ticket?: number; };\n//             const transactions = item.transactions ?? fallback.transaction_count ?? 0;\n//             const avgTicketValue = fallback.avg_ticket ?? (transactions ? item.total_sales / transactions : 0);\n\n//             return (\n//               <li key={item.user_id} className=\"rounded-lg border border-slate-100 bg-white px-3 py-2\">\n//                 <div className=\"flex items-center justify-between text-sm font-semibold text-slate-800\">\n//                   <span>{item.name}</span>\n//                   <span className=\"text-emerald-700\">{formatCurrency(item.total_sales)}</span>\n//                 </div>\n//                 <div className=\"mt-1 text-xs text-slate-600\">\n//                   {transactions.toLocaleString(\"en-US\")} sales • {formatCurrency(avgTicketValue)} avg ticket\n//                 </div>\n//               </li>\n//             );\n//           })}\n//         </ul>\n//       )}\n//     </CardContent>\n//   </Card>\n// </section>\n\n{/* Staff activity + recent payments */ }\n// <section className=\"grid gap-6 lg:grid-cols-5\">\n//   <Card className=\"lg:col-span-3 border border-slate-100 bg-white text-black shadow-sm\">\n//     <CardHeader className=\"flex flex-col gap-1 md:flex-row md:items-center md:justify-between\">\n//       <CardTitle className=\"text-black\">Staff activity</CardTitle>\n//       <span className=\"text-xs font-semibold uppercase tracking-wider text-slate-600\">Most recent inventory & POS changes</span>\n//     </CardHeader>\n\n//     <CardContent className=\"space-y-3\">\n//       {loading ? (\n//         <Skeleton className=\"h-40\" />\n//       ) : activityStream.length === 0 ? (\n//         <EmptyState\n//           title=\"No recent activity\"\n//           description=\"Inventory updates, POS sales and staff audits will show here.\"\n//         />\n//       ) : (\n//         <ul className=\"space-y-2\">\n//           {activityStream.map((entry) => (\n//             <li key={entry.id} className=\"rounded-lg border border-slate-100 bg-white p-3 text-sm\">\n//               <div className=\"flex items-center justify-between\">\n//                 <span className=\"font-semibold text-slate-800\">{entry.action.replace(/_/g, \" \")}</span>\n//                 <span className=\"text-xs text-slate-500\">{new Date(entry.created_at).toLocaleString()}</span>\n//               </div>\n//               <div className=\"mt-1 text-xs text-slate-600\">\n//                 {(() => {\n//                   const raw = entry as typeof entry & { description?: string };\n//                   if (raw.description) return raw.description;\n//                   if (entry.metadata) {\n//                     try {\n//                       return typeof entry.metadata === \"string\" ? entry.metadata : JSON.stringify(entry.metadata);\n//                     } catch {\n//                       return String(entry.metadata);\n//                     }\n//                   }\n//                   return \"No additional details\";\n//                 })()}\n//               </div>\n//             </li>\n//           ))}\n//         </ul>\n//       )}\n//     </CardContent>\n//   </Card>\n\n//   <Card className=\"lg:col-span-2 border border-slate-100 bg-white text-black shadow-sm\">\n//     <CardHeader>\n//       <CardTitle className=\"text-black\">Recent payment activity</CardTitle>\n//     </CardHeader>\n//     <CardContent className=\"space-y-2\">\n//       {loading ? (\n//         <Skeleton className=\"h-32\" />\n//       ) : recentPayments.length === 0 ? (\n//         <EmptyState\n//           title=\"No submissions yet\"\n//           description=\"Payment uploads appear here for the owner’s records.\"\n//         />\n//       ) : (\n//         <ul className=\"space-y-2 text-sm text-slate-800\">\n//           {recentPayments.map((payment) => {\n//             const raw = payment as typeof payment & { amount_formatted?: string; amount?: number; method?: string; };\n//             const amountDisplay = raw.amount_formatted ?? (raw.amount != null ? formatCurrency(raw.amount) : \"—\");\n//             const methodDisplay = raw.method ?? \"N/A\";\n\n//             return (\n//               <li key={payment.id} className=\"rounded-lg border border-slate-100 bg-white px-3 py-2\">\n//                 <div className=\"flex items-center justify-between text-xs text-slate-600\">\n//                   <span className=\"font-semibold uppercase text-slate-700\">{payment.status_label || payment.status}</span>\n//                   <span>{payment.created_at_formatted || new Date(payment.created_at).toLocaleString()}</span>\n//                 </div>\n//                 <div className=\"mt-1 text-xs text-slate-600\">\n//                   {amountDisplay} • {methodDisplay}\n//                 </div>\n//               </li>\n//             );\n//           })}\n//         </ul>\n//       )}\n//     </CardContent>\n//   </Card>\n// </section>\n\n{/* Top products */ }\n//   <section className=\"space-y-3\">\n//     <Card className=\"border border-slate-100 bg-white text-black shadow-sm\">\n//       <CardHeader className=\"flex flex-col gap-1 md:flex-row md:items-center md:justify-between\">\n//         <CardTitle className=\"text-black\">Top products</CardTitle>\n//         <span className=\"text-xs font-semibold uppercase tracking-wider text-slate-600\">Most recent best sellers</span>\n//       </CardHeader>\n//       <CardContent>\n//         {loading ? (\n//           <Skeleton className=\"h-32\" />\n//         ) : topProducts.length === 0 ? (\n//           <EmptyState\n//             title=\"No product insights yet\"\n//             description=\"Run more sales through the POS to see which medicines drive revenue.\"\n//           />\n//         ) : (\n//           <div className=\"overflow-x-auto\">\n//             <table className=\"min-w-full divide-y divide-slate-100 text-sm text-slate-800\">\n//               <thead className=\"bg-white\">\n//                 <tr>\n//                   <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-700\">Product</th>\n//                   <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-700\">Revenue</th>\n//                   <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-700\">Sales</th>\n//                   <th className=\"px-3 py-2 text-left font-semibold uppercase tracking-wider text-slate-700\">Quantity</th>\n//                 </tr>\n//               </thead>\n//               <tbody className=\"divide-y divide-slate-100 bg-white\">\n//                 {topProducts.map((item) => (\n//                   <tr key={item.name}>\n//                     <td className=\"px-3 py-2\">{item.name}</td>\n//                     <td className=\"px-3 py-2 text-emerald-700\">{formatCurrency(item.revenue)}</td>\n//                     <td className=\"px-3 py-2\">{item.quantity.toLocaleString(\"en-US\")}</td>\n//                     <td className=\"px-3 py-2\">{item.quantity.toLocaleString(\"en-US\")}</td>\n//                   </tr>\n//                 ))}\n//               </tbody>\n//             </table>\n//           </div>\n//         )}\n//       </CardContent>\n//     </Card>\n//   </section>\n// </div> */}"],"names":[],"mappings":"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"}