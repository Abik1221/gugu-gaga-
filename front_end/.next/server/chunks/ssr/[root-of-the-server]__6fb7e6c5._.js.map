{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///home/habtamusemagn/Desktop/gugu-gaga-/front_end/utils/api.ts"],"sourcesContent":["export const API_BASE = process.env.NEXT_PUBLIC_API_BASE || \"http://localhost:8000/api/v1\";\nexport const TENANT_HEADER = process.env.NEXT_PUBLIC_TENANT_HEADER || \"X-Tenant-ID\";\n\nfunction buildHeaders(initHeaders?: HeadersInit, tenantId?: string): HeadersInit {\n  const headers: Record<string, string> = {\n    ...(initHeaders as Record<string, string>),\n  };\n  if (tenantId) headers[TENANT_HEADER] = tenantId;\n  return headers;\n}\n\nexport async function postForm<T = any>(path: string, data: Record<string, string>, tenantId?: string): Promise<T> {\n  const body = new URLSearchParams(data);\n  const res = await fetch(`${API_BASE}${path}`, {\n    method: \"POST\",\n    headers: buildHeaders({\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\n    }, tenantId),\n    body,\n  });\n  if (!res.ok) {\n    try {\n      const data = await res.json();\n      const msg = data?.error || data?.detail || JSON.stringify(data);\n      throw new Error(msg || `Request failed with ${res.status}`);\n    } catch {\n      const text = await res.text().catch(() => \"\");\n      throw new Error(text || `Request failed with ${res.status}`);\n    }\n  }\n  return (await res.json()) as T;\n}\n\nexport async function postMultipart<T = any>(path: string, formData: FormData, tenantId?: string): Promise<T> {\n  const res = await fetch(`${API_BASE}${path}`, {\n    method: \"POST\",\n    headers: buildHeaders(undefined, tenantId),\n    body: formData,\n  });\n  if (!res.ok) {\n    try {\n      const data = await res.json();\n      const msg = data?.error || data?.detail || JSON.stringify(data);\n      throw new Error(msg || `Request failed with ${res.status}`);\n    } catch {\n      let message = `Request failed with ${res.status}`;\n      throw new Error(message);\n    }\n  }\n  return (await res.json()) as T;\n}\n\nexport function getAccessToken(): string | null {\n  if (typeof window === \"undefined\") return null;\n  return localStorage.getItem(\"access_token\");\n}\n\nfunction getRefreshToken(): string | null {\n  if (typeof window === \"undefined\") return null;\n  return localStorage.getItem(\"refresh_token\");\n}\n\nasync function refreshTokens(): Promise<boolean> {\n  const rt = getRefreshToken();\n  if (!rt) return false;\n  const url = `${API_BASE}/api/v1/auth/refresh?refresh_token=${encodeURIComponent(rt)}`;\n  const res = await fetch(url, { method: \"POST\" });\n  if (!res.ok) return false;\n  try {\n    const data = (await res.json()) as {\n      access_token: string;\n      refresh_token: string;\n      token_type: string;\n      expires_in: number;\n    };\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(\"access_token\", data.access_token);\n      localStorage.setItem(\"refresh_token\", data.refresh_token);\n    }\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nasync function authFetch(path: string, init?: RequestInit, retry = true, tenantId?: string): Promise<Response> {\n  const token = getAccessToken();\n  const headers: HeadersInit = buildHeaders(\n    {\n      ...(init?.headers || {}),\n      ...(token ? { Authorization: `Bearer ${token}` } : {}),\n    },\n    tenantId,\n  );\n  const res = await fetch(`${API_BASE}${path}`, { ...(init || {}), headers });\n  if (res.status === 401 && retry) {\n    const ok = await refreshTokens();\n    if (ok) {\n      const newToken = getAccessToken();\n      const retryHeaders: HeadersInit = buildHeaders(\n        {\n          ...(init?.headers || {}),\n          ...(newToken ? { Authorization: `Bearer ${newToken}` } : {}),\n        },\n        tenantId,\n      );\n      return fetch(`${API_BASE}${path}`, { ...(init || {}), headers: retryHeaders });\n    }\n  }\n  return res;\n}\n\nexport async function getAuthJSON<T = any>(path: string, tenantId?: string): Promise<T> {\n  const res = await authFetch(path, undefined, true, tenantId);\n  if (!res.ok) {\n    try {\n      const data = await res.json();\n      const msg = data?.error || data?.detail || JSON.stringify(data);\n      throw new Error(msg || `Request failed with ${res.status}`);\n    } catch {\n      const text = await res.text().catch(() => \"\");\n      throw new Error(text || `Request failed with ${res.status}`);\n    }\n  }\n  return (await res.json()) as T;\n}\n\nexport async function postAuthJSON<T = any>(path: string, bodyData: any, tenantId?: string): Promise<T> {\n  const res = await authFetch(path, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(bodyData),\n  }, true, tenantId);\n  if (!res.ok) {\n    try {\n      const data = await res.json();\n      const msg = data?.error || data?.detail || JSON.stringify(data);\n      throw new Error(msg || `Request failed with ${res.status}`);\n    } catch {\n      const text = await res.text().catch(() => \"\");\n      throw new Error(text || `Request failed with ${res.status}`);\n    }\n  }\n  return (await res.json()) as T;\n}\n\n// Convenience wrappers for key flows\nexport const AuthAPI = {\n  registerAffiliate: (body: any) => postAuthJSON(\"/auth/register/affiliate\", body),\n  registerPharmacy: (body: any) => postAuthJSON(\"/auth/register/pharmacy\", body),\n  login: (email: string, password: string, tenantId?: string) =>\n    postForm(\"/auth/login\", { username: email, password }, tenantId),\n  loginRequestCode: (email: string, password: string, tenantId?: string) =>\n    postForm(\"/auth/login/request-code\", { username: email, password }, tenantId),\n  loginVerify: (email: string, code: string, tenantId?: string) =>\n    postAuthJSON(\"/auth/login/verify\", { email, code }, tenantId),\n  me: () => getAuthJSON(\"/auth/me\"),\n};\n\nexport const AffiliateAPI = {\n  getLinks: () => getAuthJSON(\"/affiliate/register-link\"),\n  createLink: () => getAuthJSON(\"/affiliate/register-link?create_new=true\"),\n  deactivate: (token: string) => postAuthJSON(`/affiliate/links/${encodeURIComponent(token)}/deactivate`, {}),\n  rotate: (token: string) => postAuthJSON(`/affiliate/links/${encodeURIComponent(token)}/rotate`, {}),\n  dashboard: () => getAuthJSON(\"/affiliate/dashboard\"),\n  payouts: (status?: string) => getAuthJSON(`/affiliate/payouts${status ? `?status_filter=${encodeURIComponent(status)}` : \"\"}`),\n  requestPayout: (month?: string, percent = 5) => postAuthJSON(\"/affiliate/payouts/request\", { month, percent }),\n  updateProfile: (body: any) => postAuthJSON(\"/affiliate/profile\", body),\n};\n\nexport const AdminAPI = {\n  pharmacies: (page = 1, pageSize = 20, q?: string) =>\n    getAuthJSON(`/admin/pharmacies?page=${page}&page_size=${pageSize}${q ? `&q=${encodeURIComponent(q)}` : \"\"}`),\n  affiliates: (page = 1, pageSize = 20, q?: string) =>\n    getAuthJSON(`/admin/affiliates?page=${page}&page_size=${pageSize}${q ? `&q=${encodeURIComponent(q)}` : \"\"}`),\n  approvePharmacy: (tenantId: string, applicationId: number) =>\n    postAuthJSON(`/admin/pharmacies/${applicationId}/approve`, {}, tenantId),\n  rejectPharmacy: (tenantId: string, applicationId: number) =>\n    postAuthJSON(`/admin/pharmacies/${applicationId}/reject`, {}, tenantId),\n  verifyPayment: (tenantId: string, code: string) =>\n    postAuthJSON(`/admin/payments/${encodeURIComponent(code)}/verify`, {}, tenantId),\n  approveAffiliate: (userId: number) => postAuthJSON(`/admin/affiliates/${userId}/approve`, {}),\n  rejectAffiliate: (userId: number) => postAuthJSON(`/admin/affiliates/${userId}/reject`, {}),\n  listAffiliatePayouts: (status?: string) =>\n    getAuthJSON(`/admin/affiliate/payouts${status ? `?status=${encodeURIComponent(status)}` : \"\"}`),\n  markPayoutPaid: (payoutId: number) => postAuthJSON(`/admin/affiliate/payouts/${payoutId}/mark-paid`, {}),\n  approvePayout: (payoutId: number) => postAuthJSON(`/admin/affiliate/payouts/${payoutId}/approve`, {}),\n  usage: (days = 30) => getAuthJSON(`/admin/usage?days=${days}`),\n  audit: (params?: { tenant_id?: string; action?: string; limit?: number }) =>\n    getAuthJSON(\n      `/admin/audit${(() => {\n        const qs = new URLSearchParams();\n        if (params?.tenant_id) qs.set(\"tenant_id\", params.tenant_id);\n        if (params?.action) qs.set(\"action\", params.action);\n        if (params?.limit) qs.set(\"limit\", String(params.limit));\n        const s = qs.toString();\n        return s ? `?${s}` : \"\";\n      })()}`,\n    ),\n};\n\nexport const StaffAPI = {\n  createCashier: (tenantId: string, body: any) => postAuthJSON(\"/staff\", body, tenantId),\n  list: (tenantId: string) => getAuthJSON(\"/staff\", tenantId),\n  update: (tenantId: string, userId: number, body: { is_active?: boolean }) =>\n    authFetch(`/staff/${userId}`, { method: \"PATCH\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify(body) }, true, tenantId)\n      .then(async (res)=>{ if (!res.ok) { const t = await res.text(); throw new Error(t || `HTTP ${res.status}`); } return res.json(); }),\n  remove: (tenantId: string, userId: number) =>\n    authFetch(`/staff/${userId}`, { method: \"DELETE\" }, true, tenantId)\n      .then(async (res)=>{ if (!res.ok) { const t = await res.text(); throw new Error(t || `HTTP ${res.status}`); } return res.json(); }),\n};\n\nexport const UploadAPI = {\n  uploadKyc: async (file: File): Promise<{ path: string; size: number; filename: string }> => {\n    const fd = new FormData();\n    fd.append(\"file\", file);\n    return await postMultipart(`/uploads/kyc`, fd);\n  },\n};\n\nexport const PharmaciesAPI = {\n  list: (page = 1, pageSize = 20, q?: string) =>\n    getAuthJSON(`/pharmacies?page=${page}&page_size=${pageSize}${q ? `&q=${encodeURIComponent(q)}` : \"\"}`),\n  get: (id: number) => getAuthJSON(`/pharmacies/${id}`),\n  update: (id: number, body: { name?: string; address?: string }) =>\n    authFetch(`/pharmacies/${id}`, { method: \"PATCH\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify(body) })\n      .then(async (res)=>{ if (!res.ok) { const t = await res.text(); throw new Error(t || `HTTP ${res.status}`); } return res.json(); }),\n};\n\nexport const ChatAPI = {\n  listThreads: (tenantId: string) => getAuthJSON(`/chat/threads`, tenantId),\n  createThread: (tenantId: string, title: string) => postAuthJSON(`/chat/threads`, { title }, tenantId),\n  listMessages: (tenantId: string, threadId: number) => getAuthJSON(`/chat/threads/${threadId}/messages`, tenantId),\n  sendMessage: (tenantId: string, threadId: number, prompt: string) =>\n    postAuthJSON(`/chat/threads/${threadId}/messages`, { prompt }, tenantId),\n  usage: (tenantId: string, days = 30) => getAuthJSON(`/chat/usage?days=${days}`, tenantId),\n  sendStream: async (\n    tenantId: string,\n    threadId: number,\n    prompt: string,\n    onEvent: (evt: { event: string; data?: any }) => void,\n  ): Promise<void> => {\n    const res = await authFetch(`/chat/threads/${threadId}/messages/stream`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ prompt }),\n    }, true, tenantId);\n    if (!res.ok || !res.body) {\n      const t = await res.text().catch(()=>\"\");\n      throw new Error(t || `HTTP ${res.status}`);\n    }\n    const reader = res.body.getReader();\n    const decoder = new TextDecoder();\n    let buf = \"\";\n    while (true) {\n      const { done, value } = await reader.read();\n      if (done) break;\n      buf += decoder.decode(value, { stream: true });\n      let idx;\n      while ((idx = buf.indexOf(\"\\n\\n\")) !== -1) {\n        const chunk = buf.slice(0, idx).trim();\n        buf = buf.slice(idx + 2);\n        if (chunk.startsWith(\"data:\")) {\n          try {\n            const jsonStr = chunk.slice(5).trim();\n            const obj = JSON.parse(jsonStr);\n            onEvent(obj);\n          } catch {}\n        }\n      }\n    }\n  },\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 344, "column": 0}, "map": {"version":3,"sources":["file:///home/habtamusemagn/Desktop/gugu-gaga-/front_end/lib/utils.ts"],"sourcesContent":["// src/lib/utils.js (or utils.ts for TypeScript)\nimport classNames from \"classnames\";\n\nexport function cn(...inputs: any) {\n  return classNames(inputs);\n}\n"],"names":[],"mappings":"AAAA,gDAAgD;;;;;AAChD;;AAEO,SAAS,GAAG,GAAG,MAAW;IAC/B,OAAO,IAAA,8IAAU,EAAC;AACpB","debugId":null}},
    {"offset": {"line": 358, "column": 0}, "map": {"version":3,"sources":["file:///home/habtamusemagn/Desktop/gugu-gaga-/front_end/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60\",\n        outline:\n          \"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost:\n          \"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2 has-[>svg]:px-3\",\n        sm: \"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5\",\n        lg: \"h-10 rounded-md px-6 has-[>svg]:px-4\",\n        icon: \"size-9\",\n        \"icon-sm\": \"size-8\",\n        \"icon-lg\": \"size-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n);\n\nfunction Button({\n  className,\n  variant,\n  size,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> &\n  VariantProps<typeof buttonVariants> & {\n    asChild?: boolean;\n  }) {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  );\n}\n\nexport { Button, buttonVariants };\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,uKAAG,EACxB,+bACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,EACd,SAAS,EACT,OAAO,EACP,IAAI,EACJ,UAAU,KAAK,EACf,GAAG,OAIF;IACD,MAAM,OAAO,UAAU,wKAAI,GAAG;IAE9B,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf","debugId":null}},
    {"offset": {"line": 417, "column": 0}, "map": {"version":3,"sources":["file:///home/habtamusemagn/Desktop/gugu-gaga-/front_end/app/%28dashboard%29/layout.tsx"],"sourcesContent":["// Dashboard layout (sidebar, nav)\n\"use client\";\nimport React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { API_BASE, getAccessToken, getAuthJSON } from \"@/utils/api\";\nimport Link from \"next/link\";\nimport { usePathname } from \"next/navigation\";\nimport { Button } from \"@/components/ui/button\";\n\ntype Me = {\n  id: string;\n  email: string;\n  username: string;\n  tenant_id?: string;\n  roles?: { role: { name: string } }[];\n};\n\nexport default function DashboardLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const router = useRouter();\n  const [loading, setLoading] = useState(true);\n  const [user, setUser] = useState<Me | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [subBanner, setSubBanner] = useState<{ inactive: boolean; in_trial: boolean; trial_days_left?: number } | null>(null);\n\n  useEffect(() => {\n    let active = true;\n    async function check() {\n      try {\n        const me = await getAuthJSON<Me>(\"/api/v1/auth/me\");\n        if (!active) return;\n        setUser(me);\n        // One-time referral track\n        try {\n          const ref = typeof window !== \"undefined\" ? localStorage.getItem(\"referral_code\") : null;\n          if (ref && me?.id) {\n            const token = getAccessToken();\n            await fetch(`${API_BASE}/api/v1/affiliate/referrals/track`, {\n              method: \"POST\",\n              headers: {\n                \"Content-Type\": \"application/json\",\n                ...(token ? { Authorization: `Bearer ${token}` } : {}),\n                ...(me?.tenant_id ? { \"X-Tenant-ID\": me.tenant_id } : {}),\n              },\n              body: JSON.stringify({ referral_code: ref, referred_user_id: me.id }),\n            });\n            localStorage.removeItem(\"referral_code\");\n          }\n        } catch {}\n      } catch (e: any) {\n        if (!active) return;\n        setError(\"Unauthorized\");\n        router.replace(\"/login\");\n      } finally {\n        if (active) setLoading(false);\n      }\n    }\n    // If no token, redirect immediately\n    if (typeof window !== \"undefined\" && !localStorage.getItem(\"access_token\")) {\n      setLoading(false);\n      router.replace(\"/login\");\n      return;\n    }\n    check();\n    // Fetch subscription status to show banner if inactive (non-blocking UX hint)\n    (async () => {\n      try {\n        const token = getAccessToken();\n        const tenant = typeof window !== \"undefined\" ? localStorage.getItem(\"tenant_id\") : null;\n        if (!token || !tenant) return;\n        const res = await fetch(`${API_BASE}/api/v1/subscriptions/current?tenant_id=${encodeURIComponent(tenant)}`, { headers: { Authorization: `Bearer ${token}` } });\n        if (!res.ok) return;\n        const data = await res.json();\n        const inactive = !data?.in_trial && String(data?.status || \"\").toLowerCase() !== \"active\";\n        setSubBanner({ inactive, in_trial: !!data?.in_trial, trial_days_left: data?.trial_days_left });\n      } catch {}\n    })();\n    return () => {\n      active = false;\n    };\n  }, [router]);\n\n  function logout() {\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(\"access_token\");\n      localStorage.removeItem(\"refresh_token\");\n    }\n    router.replace(\"/login\");\n  }\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"animate-pulse text-gray-500\">Loading dashboard...</div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return null; // Redirected\n  }\n\n  return (\n    <Shell user={user} onLogout={logout}>\n      {subBanner?.inactive && (\n        <div className=\"mb-4 p-3 border rounded bg-amber-50 text-amber-800 text-sm\">\n          Subscription inactive. Please go to Billing to activate and restore full access.\n          <a href=\"/dashboard/settings\" className=\"ml-3 underline\">Go to Billing</a>\n        </div>\n      )}\n      {children}\n    </Shell>\n  );\n}\n\nfunction Shell({\n  user,\n  onLogout,\n  children,\n}: {\n  user: Me | null;\n  onLogout: () => void;\n  children: React.ReactNode;\n}) {\n  const pathname = usePathname();\n  const isOwnerOrManager = (user?.roles || []).some(r => {\n    const n = (r?.role?.name || \"\").toLowerCase();\n    return n === \"owner\" || n === \"manager\";\n  });\n  const nav = [\n    { href: \"/dashboard\", label: \"Overview\" },\n    { href: \"/dashboard/inventory\", label: \"Inventory\" },\n    { href: \"/dashboard/pos\", label: \"POS\" },\n    { href: \"/dashboard/affiliate\", label: \"Affiliate\" },\n    ...(isOwnerOrManager ? [{ href: \"/dashboard/admin/payouts\", label: \"Payouts\" }] : []),\n    { href: \"/dashboard/settings\", label: \"Settings\" },\n    { href: \"/dashboard/about\", label: \"About\" },\n  ];\n\n  return (\n    <div className=\"min-h-screen grid grid-cols-12\">\n      <aside className=\"col-span-12 md:col-span-2 border-r p-4 space-y-6 bg-white\">\n        <div className=\"space-y-1\">\n          <div className=\"text-lg font-semibold\">Zemen Dashboard</div>\n          <div className=\"text-xs text-gray-500\">Secure area</div>\n        </div>\n\n        <div className=\"space-y-1 text-sm\">\n          {user ? (\n            <div>\n              <div className=\"font-medium\">{user.username}</div>\n              <div className=\"text-xs text-gray-500 truncate\">{user.email}</div>\n            </div>\n          ) : null}\n        </div>\n\n        <nav className=\"space-y-1\">\n          {nav.map((item) => {\n            const active = pathname === item.href || pathname?.startsWith(item.href + \"/\");\n            return (\n              <Link\n                key={item.href}\n                href={item.href}\n                className={\n                  \"block rounded px-3 py-2 text-sm \" +\n                  (active\n                    ? \"bg-emerald-50 text-emerald-700 border border-emerald-200\"\n                    : \"hover:bg-gray-50 text-gray-700\")\n                }\n              >\n                {item.label}\n              </Link>\n            );\n          })}\n        </nav>\n\n        <div className=\"pt-4\">\n          <Button variant=\"outline\" onClick={onLogout} className=\"w-full text-red-600 border-red-200 hover:bg-red-50\">\n            Logout\n          </Button>\n        </div>\n      </aside>\n\n      <div className=\"col-span-12 md:col-span-10 flex flex-col min-h-screen bg-gray-50\">\n        <header className=\"border-b bg-white p-4 flex items-center justify-between\">\n          <div className=\"font-medium\">{nav.find(n => pathname?.startsWith(n.href))?.label || \"Overview\"}</div>\n          <div className=\"text-sm text-gray-500\">Tenant: {user?.tenant_id || \"N/A\"}</div>\n        </header>\n        <main className=\"p-6 flex-1\">{children}</main>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}