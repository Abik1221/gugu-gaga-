module.exports=[34888,a=>{"use strict";a.s(["default",()=>k]);var b=a.i(90944),c=a.i(72131),d=a.i(50944),e=a.i(75320),f=a.i(50463),g=a.i(40695),h=a.i(5522),i=a.i(64037),j=a.i(38246);function k(){let{show:a}=(0,i.useToast)(),k=(0,d.useParams)(),l=k?.id||"",[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(null);(0,c.useEffect)(()=>{let b=!0;async function c(){try{await (0,e.getAuthJSON)("/auth/me");let a=(0,e.getAccessToken)(),[c,d]=await Promise.all([fetch(`${e.API_BASE}/admin/users/${encodeURIComponent(l)}`,{headers:a?{Authorization:`Bearer ${a}`}:{}}),fetch(`${e.API_BASE}/admin/roles`,{headers:a?{Authorization:`Bearer ${a}`}:{}})]);if(!c.ok)throw Error(await c.text().catch(()=>"Failed to load user"));if(!d.ok)throw Error(await d.text().catch(()=>"Failed to load roles"));let f=await c.json(),g=await d.json();if(!b)return;p(f),r(Array.isArray(g)?g:[])}catch(c){if(!b)return;a({variant:"destructive",title:"Failed to load",description:c.message||""})}finally{b&&n(!1)}}return l&&c(),()=>{b=!1}},[a,l]);let w=new Set((o?.roles||[]).map(a=>String(a.role?.id||a.id))),x=(0,c.useMemo)(()=>{let a=s.trim().toLowerCase(),b=q;return a&&(b=b.filter(b=>String(b.name||"").toLowerCase().includes(a))),b},[q,s]);async function y(b){v(b);try{let c=(0,e.getAccessToken)(),d=await fetch(`${e.API_BASE}/admin/users/${encodeURIComponent(l)}/assign-role`,{method:"POST",headers:{"Content-Type":"application/json",...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify({role:b})});if(!d.ok)throw Error(await d.text().catch(()=>"Failed to assign"));let f=await fetch(`${e.API_BASE}/admin/users/${encodeURIComponent(l)}`,{headers:c?{Authorization:`Bearer ${c}`}:{}}),g=await f.json();p(g),a({variant:"success",title:"Role assigned"})}catch(b){a({variant:"destructive",title:"Assign failed",description:b.message||""})}finally{v(null)}}async function z(b){v(b);try{let c=(0,e.getAccessToken)(),d=await fetch(`${e.API_BASE}/admin/users/${encodeURIComponent(l)}/remove-role`,{method:"POST",headers:{"Content-Type":"application/json",...c?{Authorization:`Bearer ${c}`}:{}},body:JSON.stringify({role:b})});if(!d.ok)throw Error(await d.text().catch(()=>"Failed to remove"));let f=await fetch(`${e.API_BASE}/admin/users/${encodeURIComponent(l)}`,{headers:c?{Authorization:`Bearer ${c}`}:{}}),g=await f.json();p(g),a({variant:"success",title:"Role removed"})}catch(b){a({variant:"destructive",title:"Remove failed",description:b.message||""})}finally{v(null)}}return m?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(f.Skeleton,{className:"h-8 w-64"}),(0,b.jsx)("div",{className:"space-y-2",children:Array.from({length:6}).map((a,c)=>(0,b.jsx)(f.Skeleton,{className:"h-14"},c))})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h1",{className:"text-xl font-semibold",children:"User Roles"}),(0,b.jsx)(j.default,{href:"/dashboard/admin/users",className:"text-sm border rounded px-2 py-1 hover:bg-gray-50",children:"Back"})]}),(0,b.jsxs)("div",{className:"border rounded bg-white p-4",children:[(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"User:"})," ",o?.username||"-"," (",o?.email||"-",")"]}),(0,b.jsxs)("div",{className:"text-xs text-gray-600",children:["ID: ",o?.id]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"font-medium",children:"Available Roles"}),(0,b.jsx)(h.Input,{placeholder:"Filter roles",value:s,onChange:a=>t(a.target.value),className:"w-64"})]}),(0,b.jsxs)("div",{className:"border rounded bg-white divide-y",children:[(0,b.jsxs)("div",{className:"grid grid-cols-12 p-3 text-xs text-gray-600",children:[(0,b.jsx)("div",{className:"col-span-4",children:"Role Name"}),(0,b.jsx)("div",{className:"col-span-6",children:"ID"}),(0,b.jsx)("div",{className:"col-span-2 text-right",children:"Action"})]}),x.map(a=>{let c=String(a.id),d=w.has(c);return(0,b.jsxs)("div",{className:"grid grid-cols-12 p-3 items-center",children:[(0,b.jsx)("div",{className:"col-span-4",children:a.name}),(0,b.jsx)("div",{className:"col-span-6 text-xs text-gray-600 truncate",children:c}),(0,b.jsx)("div",{className:"col-span-2 text-right",children:d?(0,b.jsx)(g.Button,{variant:"outline",disabled:u===c,onClick:()=>z(c),children:u===c?"Removing...":"Remove"}):(0,b.jsx)(g.Button,{disabled:u===c,onClick:()=>y(c),children:u===c?"Assigning...":"Assign"})})]},c)}),0===x.length&&(0,b.jsx)("div",{className:"p-6 text-gray-500",children:"No roles."})]})]})}}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_admin_users_%5Bid%5D_roles_page_tsx_7f16ac60._.js.map