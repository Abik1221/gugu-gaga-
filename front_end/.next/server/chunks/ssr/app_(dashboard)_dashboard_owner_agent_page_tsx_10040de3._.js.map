{"version":3,"sources":["turbopack:///[project]/app/(dashboard)/dashboard/owner/agent/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { AuthAPI, ChatAPI } from \"@/utils/api\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/components/ui/toast\";\n\ntype ThreadSummary = {\n  id: number;\n  title?: string | null;\n};\n\ntype ChatMessageRecord = {\n  id: number;\n  role: string;\n  content: string;\n};\n\nconst ROLE_LABELS: Record<string, string> = {\n  user: \"You\",\n  owner: \"You\",\n  assistant: \"Assistant\",\n};\n\nconst ROLE_TONE: Record<string, string> = {\n  user: \"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/20\",\n  owner:\n    \"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/20\",\n  assistant: \"bg-white/90 border border-white/40 text-slate-900 backdrop-blur\",\n};\n\nfunction normalizeThreadTitle(thread: ThreadSummary, index: number): string {\n  const raw = (thread.title || \"\").trim();\n  if (raw) return raw;\n  return `Conversation #${index + 1}`;\n}\n\nfunction parseAssistantPayload(content: string): any | null {\n  if (!content) return null;\n  try {\n    return JSON.parse(content);\n  } catch {\n    if (content.startsWith(\"{\") && content.includes(\"'\")) {\n      try {\n        const sanitized = content.replace(/'/g, '\"');\n        return JSON.parse(sanitized);\n      } catch {\n        return null;\n      }\n    }\n    return null;\n  }\n}\n\nfunction AssistantContent({ payload }: { payload: any }) {\n  if (!payload || typeof payload !== \"object\") {\n    return null;\n  }\n\n  const rows = Array.isArray(payload.rows) ? payload.rows : null;\n  const hasRows = rows && rows.length > 0;\n\n  const remaining = MAX_PROMPT_LENGTH - messageDraft.length;\n  const isOverLimit = remaining < 0;\n\n  return (\n    <div className=\"space-y-4 text-sm\">\n      {payload.intent && (\n        <div className=\"flex items-center gap-2 rounded-lg border border-emerald-200 bg-emerald-50 px-4 py-3 text-emerald-800\">\n          <span className=\"text-xs font-semibold uppercase tracking-wider\">\n            Intent\n          </span>\n          <span className=\"font-medium\">{String(payload.intent)}</span>\n        </div>\n      )}\n      {payload.error && (\n        <div className=\"rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800\">\n          Unable to run the analysis at the moment. ({String(payload.error)})\n        </div>\n      )}\n      {payload.answer && typeof payload.answer === \"string\" && (\n        <p className=\"whitespace-pre-wrap leading-relaxed text-slate-800\">\n          {payload.answer}\n        </p>\n      )}\n      {hasRows ? (\n        <div className=\"overflow-x-auto rounded-lg border border-slate-200\">\n          <table className=\"min-w-full divide-y divide-slate-200 text-sm\">\n            <thead className=\"bg-slate-50\">\n              <tr>\n                {Object.keys(rows![0]).map((key) => (\n                  <th\n                    key={key}\n                    className=\"px-4 py-3 text-left font-semibold uppercase tracking-wider text-slate-900\"\n                  >\n                    {key}\n                  </th>\n                ))}\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-slate-100 bg-white\">\n              {rows!.map((row, idx) => (\n                <tr key={idx} className=\"hover:bg-slate-50\">\n                  {Object.keys(rows![0]).map((key) => (\n                    <td key={key} className=\"px-4 py-3 text-slate-700\">\n                      {row[key] === null || row[key] === undefined\n                        ? \"—\"\n                        : typeof row[key] === \"number\"\n                        ? row[key].toLocaleString(\"en-US\")\n                        : String(row[key])}\n                    </td>\n                  ))}\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      ) : null}\n      {!payload.error && rows && rows.length === 0 && (\n        <div className=\"rounded-lg border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-600\">\n          The query completed but returned no rows.\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default function OwnerAgentPage() {\n  const { show } = useToast();\n\n  const [tenantId, setTenantId] = useState<string | null>(null);\n  const [threads, setThreads] = useState<ThreadSummary[]>([]);\n  const [threadsLoading, setThreadsLoading] = useState(false);\n  const [selectedThreadId, setSelectedThreadId] = useState<number | null>(null);\n  const [messages, setMessages] = useState<ChatMessageRecord[]>([]);\n  const [messagesLoading, setMessagesLoading] = useState(false);\n  const [messageDraft, setMessageDraft] = useState(\"\");\n  const [creatingThread, setCreatingThread] = useState(false);\n  const [sending, setSending] = useState(false);\n  const [assistantThinking, setAssistantThinking] = useState(false);\n  const [bootstrapLoading, setBootstrapLoading] = useState(true);\n  const [globalError, setGlobalError] = useState<string | null>(null);\n  const [showHistory, setShowHistory] = useState(false);\n\n  const messagesEndRef = useRef<HTMLDivElement | null>(null);\n\n  const selectedThread = useMemo(\n    () => threads.find((thread) => thread.id === selectedThreadId) || null,\n    [threads, selectedThreadId]\n  );\n\n  const loadThreads = useCallback(\n    async (tid: string): Promise<ThreadSummary[]> => {\n      setThreadsLoading(true);\n      try {\n        const data = await ChatAPI.listThreads(tid);\n        const safe = Array.isArray(data) ? (data as ThreadSummary[]) : [];\n        setThreads(safe);\n        if (safe.length === 0) {\n          setSelectedThreadId(null);\n        }\n        setGlobalError(null);\n        return safe;\n      } catch (error: any) {\n        setThreads([]);\n        setSelectedThreadId(null);\n        setGlobalError(error?.message || \"Unable to load conversations\");\n        return [];\n      } finally {\n        setThreadsLoading(false);\n      }\n    },\n    []\n  );\n\n  const loadMessages = useCallback(\n    async (tid: string, threadId: number) => {\n      setMessagesLoading(true);\n      try {\n        const data = await ChatAPI.listMessages(tid, threadId);\n        const safe = Array.isArray(data) ? (data as ChatMessageRecord[]) : [];\n        setMessages(safe);\n      } catch (error: any) {\n        show({\n          variant: \"destructive\",\n          title: \"Failed to load thread\",\n          description: error?.message || \"Unable to fetch messages.\",\n        });\n      } finally {\n        setMessagesLoading(false);\n      }\n    },\n    [show]\n  );\n\n  useEffect(() => {\n    let active = true;\n    async function bootstrap() {\n      setBootstrapLoading(true);\n      try {\n        const profile = await AuthAPI.me();\n        if (!active) return;\n        const tid = profile?.tenant_id || null;\n        if (!tid) {\n          setGlobalError(\"You do not have an active tenant to chat against.\");\n          return;\n        }\n        setTenantId(tid);\n        await loadThreads(tid);\n      } catch (error: any) {\n        if (!active) return;\n        setGlobalError(error?.message || \"Unable to load owner profile.\");\n      } finally {\n        if (active) setBootstrapLoading(false);\n      }\n    }\n    bootstrap();\n    return () => {\n      active = false;\n    };\n  }, [loadThreads]);\n\n  useEffect(() => {\n    if (\n      selectedThreadId &&\n      !threads.some((thread) => thread.id === selectedThreadId)\n    ) {\n      setSelectedThreadId(threads[0]?.id ?? null);\n    } else if (!selectedThreadId && threads.length > 0) {\n      setSelectedThreadId(threads[0].id);\n    }\n  }, [threads, selectedThreadId]);\n\n  useEffect(() => {\n    if (!tenantId || !selectedThreadId) {\n      setMessages([]);\n      return;\n    }\n    loadMessages(tenantId, selectedThreadId);\n  }, [tenantId, selectedThreadId, loadMessages]);\n\n  useEffect(() => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: \"smooth\" });\n    }\n  }, [messages, assistantThinking]);\n\n  const handleCreateThread = async () => {\n    if (!tenantId) return;\n    setCreatingThread(true);\n    try {\n      const created = await ChatAPI.createThread(tenantId);\n      await loadThreads(tenantId);\n      if (created?.id) {\n        setSelectedThreadId(created.id);\n      }\n      setMessages([]);\n    } catch (error: any) {\n      show({\n        variant: \"destructive\",\n        title: \"Could not create thread\",\n        description: error?.message || \"Please try again.\",\n      });\n    } finally {\n      setCreatingThread(false);\n    }\n  };\n\n  const MAX_PROMPT_LENGTH = 300;\n  const remaining = MAX_PROMPT_LENGTH - messageDraft.length;\n  const isOverLimit = remaining < 0;\n\n  const handleSendMessage = async () => {\n    if (!tenantId) return;\n    const prompt = messageDraft.trim();\n    if (!prompt) return;\n    if (prompt.length > MAX_PROMPT_LENGTH) {\n      show({\n        variant: \"destructive\",\n        title: \"Prompt too long\",\n        description: `Limit is ${MAX_PROMPT_LENGTH} characters. Please shorten your question.`,\n      });\n      return;\n    }\n    setMessageDraft(\"\");\n    setSending(true);\n    setAssistantThinking(true);\n    try {\n      let threadIdToUse = selectedThreadId;\n      if (!threadIdToUse) {\n        const created = await ChatAPI.createThread(tenantId);\n        const refreshed = await loadThreads(tenantId);\n        threadIdToUse =\n          (created && typeof created.id === \"number\"\n            ? created.id\n            : undefined) ??\n          (refreshed.length > 0 ? refreshed[0].id : undefined);\n        if (threadIdToUse) {\n          setSelectedThreadId(threadIdToUse);\n        }\n      }\n      if (!threadIdToUse) {\n        throw new Error(\"Unable to start a new conversation\");\n      }\n\n      await ChatAPI.sendMessage(tenantId, threadIdToUse, prompt);\n      await loadMessages(tenantId, threadIdToUse);\n      await loadThreads(tenantId);\n    } catch (error: any) {\n      show({\n        variant: \"destructive\",\n        title: \"Message failed\",\n        description: error?.message || \"Unable to send message.\",\n      });\n      setMessageDraft(prompt);\n    } finally {\n      setSending(false);\n      setAssistantThinking(false);\n    }\n  };\n\n  const handleComposerKeyDown = (\n    event: React.KeyboardEvent<HTMLTextAreaElement>\n  ) => {\n    if (event.key === \"Enter\" && !event.shiftKey) {\n      event.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const isLoadingThreads = threadsLoading || bootstrapLoading;\n  const isLoadingMessages = messagesLoading || bootstrapLoading;\n\n  return (\n    <div className=\"space-y-8\">\n      <div className=\"flex flex-col gap-3 rounded-2xl border border-slate-200 bg-white p-6 shadow-md\">\n        <h1 className=\"text-3xl font-semibold leading-tight text-slate-900\">\n          Zemen AI Assistant\n        </h1>\n        <p className=\"max-w-3xl text-sm leading-relaxed text-slate-600\">\n          Ask questions about sales, inventory, and staff performance. The\n          assistant runs read-only analytics on your tenant data and summarises\n          the results for quick insight.\n        </p>\n      </div>\n\n      {globalError && (\n        <div className=\"rounded border border-red-200 bg-red-50 p-3 text-sm text-red-700\">\n          {globalError}\n        </div>\n      )}\n\n      <div className=\"grid gap-6 lg:grid-cols-[320px,1fr]\">\n        <div className=\"flex flex-col gap-5 rounded-2xl border border-slate-200 bg-white p-5 shadow-md\">\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-sm font-semibold uppercase tracking-wider text-slate-900\">\n              Conversations\n            </h2>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => setShowHistory((prev) => !prev)}\n              >\n                {showHistory ? \"Hide history\" : \"Show history\"}\n              </Button>\n              <Button\n                size=\"sm\"\n                variant=\"outline\"\n                onClick={() => tenantId && loadThreads(tenantId)}\n                disabled={!tenantId || isLoadingThreads}\n              >\n                Refresh\n              </Button>\n            </div>\n          </div>\n          <div className=\"space-y-3\">\n            <Button\n              onClick={handleCreateThread}\n              disabled={!tenantId || creatingThread}\n              className=\"bg-emerald-700 hover:bg-emerald-800 text-white\"\n            >\n              {creatingThread ? \"Creating…\" : \"Start new conversation\"}\n            </Button>\n          </div>\n          {showHistory ? (\n            <>\n              <div className=\"h-px w-full bg-slate-200\" />\n              {isLoadingThreads ? (\n                <div className=\"space-y-2\">\n                  {Array.from({ length: 5 }).map((_, index) => (\n                    <Skeleton key={index} className=\"h-12 w-full\" />\n                  ))}\n                </div>\n              ) : threads.length === 0 ? (\n                <div className=\"rounded-lg border border-slate-200 bg-slate-50 p-4 text-center text-sm text-slate-600\">\n                  No conversations yet. Start a new one to ask the assistant\n                  anything about your pharmacy.\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  {threads.map((thread, index) => {\n                    const title = normalizeThreadTitle(thread, index);\n                    const isActive = thread.id === selectedThreadId;\n                    return (\n                      <button\n                        key={thread.id}\n                        type=\"button\"\n                        onClick={() => setSelectedThreadId(thread.id)}\n                        className={`group w-full rounded-lg border px-3 py-2 text-left text-sm font-medium transition ${\n                          isActive\n                            ? \"border-emerald-300 bg-emerald-50 text-emerald-900 shadow-sm\"\n                            : \"border-slate-200 bg-white text-slate-700 hover:border-emerald-200 hover:bg-emerald-50\"\n                        }`}\n                      >\n                        <div className=\"font-semibold\">{title}</div>\n                        <div className=\"text-xs uppercase tracking-wider text-slate-500\">\n                          Thread #{thread.id}\n                        </div>\n                      </button>\n                    );\n                  })}\n                </div>\n              )}\n            </>\n          ) : (\n            <div className=\"rounded-lg border border-slate-200 bg-slate-50 p-4 text-center text-sm text-slate-600\">\n              Tap “Show history” to browse your previous conversations.\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex flex-col gap-5 rounded-2xl border border-slate-200 bg-white p-5 shadow-md\">\n          <div className=\"flex flex-col gap-1\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-sm font-semibold uppercase tracking-wider text-slate-900\">\n                {selectedThread\n                  ? normalizeThreadTitle(selectedThread, 0)\n                  : \"Conversation\"}\n              </h2>\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() =>\n                    tenantId &&\n                    selectedThreadId &&\n                    loadMessages(tenantId, selectedThreadId)\n                  }\n                  disabled={!tenantId || !selectedThreadId || isLoadingMessages}\n                >\n                  Refresh\n                </Button>\n              </div>\n            </div>\n            <p className=\"text-xs text-slate-600\">\n              The assistant uses safe, read-only queries. Ask for sales\n              summaries, inventory gaps, or staff performance insights.\n            </p>\n          </div>\n          <div className=\"flex-1 overflow-hidden rounded-lg border border-slate-200 bg-slate-50\">\n            {isLoadingMessages ? (\n              <div className=\"p-4 space-y-3\">\n                {Array.from({ length: 5 }).map((_, index) => (\n                  <Skeleton key={index} className=\"h-16 w-full\" />\n                ))}\n              </div>\n            ) : !selectedThreadId ? (\n              <div className=\"flex h-full items-center justify-center p-6 text-sm text-slate-600\">\n                Select a conversation to view messages.\n              </div>\n            ) : messages.length === 0 ? (\n              <div className=\"flex h-full items-center justify-center p-6 text-sm text-slate-600\">\n                Ask your first question to begin.\n              </div>\n            ) : (\n              <div className=\"flex h-[55vh] flex-col gap-3 overflow-y-auto p-4 pr-6\">\n                {messages.map((message) => {\n                  const roleClass =\n                    ROLE_TONE[message.role] || ROLE_TONE.assistant;\n                  const label = ROLE_LABELS[message.role] || message.role;\n                  const assistantPayload =\n                    message.role === \"assistant\"\n                      ? parseAssistantPayload(message.content)\n                      : null;\n                  return (\n                    <div\n                      key={message.id}\n                      className={`flex ${\n                        message.role === \"assistant\"\n                          ? \"justify-start\"\n                          : \"justify-end\"\n                      }`}\n                    >\n                      <div\n                        className={`max-w-xl rounded-2xl px-3 py-2 text-sm shadow ${roleClass}`}\n                      >\n                        <div className=\"mb-1 text-xs font-semibold uppercase tracking-wide text-slate-600\">\n                          {label}\n                        </div>\n                        {assistantPayload ? (\n                          <AssistantContent payload={assistantPayload} />\n                        ) : (\n                          <p className=\"whitespace-pre-wrap leading-relaxed\">\n                            {message.content}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n                {assistantThinking && (\n                  <div className=\"flex justify-start\">\n                    <div className=\"max-w-xs rounded-lg border border-slate-200 bg-slate-100 px-3 py-2 text-sm text-slate-700 shadow-sm\">\n                      Assistant is analysing your data…\n                    </div>\n                  </div>\n                )}\n                <div ref={messagesEndRef} />\n              </div>\n            )}\n          </div>\n          <form className=\"flex flex-col gap-3 rounded-lg border border-slate-200 bg-white p-4 shadow-sm\">\n            <div className=\"flex items-center justify-between text-xs font-semibold uppercase tracking-wider text-slate-700\">\n              <span>Ask a question</span>\n              <span\n                className={`tracking-normal ${\n                  isOverLimit ? \"text-red-600\" : \"text-emerald-600\"\n                }`}\n              >\n                {remaining >= 0\n                  ? `${remaining} characters left`\n                  : `${Math.abs(remaining)} over limit`}\n              </span>\n            </div>\n            <textarea\n              className=\"min-h-[120px] w-full resize-y rounded-lg border border-slate-300 bg-white p-3 text-sm text-slate-900 placeholder:text-slate-500 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-200\"\n              placeholder=\"e.g. Show me the top selling medicines this week\"\n              value={messageDraft}\n              maxLength={MAX_PROMPT_LENGTH + 100}\n              onChange={(event) => setMessageDraft(event.target.value)}\n              onKeyDown={handleComposerKeyDown}\n            />\n            <Button\n              onClick={handleSendMessage}\n              disabled={\n                !tenantId || !selectedThreadId || sending || isOverLimit\n              }\n              className=\"bg-emerald-700 hover:bg-emerald-800 text-white\"\n            >\n              {sending ? \"Sending…\" : \"Send\"}\n            </Button>\n          </form>\n          )\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}